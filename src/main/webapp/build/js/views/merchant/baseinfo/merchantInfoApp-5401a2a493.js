angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,t,a,n,c,i,o,r,l,d,u){function C(){var e=document.getElementById("queryForm");p.url=angular.element(e).prop("action");var n=angular.copy(p.queryBean);n.pageSize=p.pagination.pageSize,n.pageNum=p.pagination.pageNum,n.beginTime=d(n.beginTime,"yyyy-MM-dd"),n.endTime=d(n.endTime,"yyyy-MM-dd"),t.post(p.url,a(n)).then(function(e){var t=e.data;t.success?(p.pagination=t.object,i.clearChecked()):alert(t.msg)})}function s(){p.queryBean={}}function m(e,t){i.updateChecked(e,t),n.debug(t),n.debug(i.getChecked())}function h(){c({modalTitle:"新增商户",modalBody:"toAdd",url:"add",item:{},cached:{MERCHANT_CODE:o.getCache("MERCHANT_CODE"),ALL_CITY:p.cached.ALL_CITY,REPRT_TYPE:o.getCache("REPRT_TYPE"),CHK_DEAL_FLAG:o.getCache("CHK_DEAL_FLAG"),CHK_METHOD:o.getCache("CHK_METHOD"),CA_APPLY_STATE:o.getCache("CA_APPLY_STATE"),MCHNT_TYPE:o.getCache("MCHNT_TYPE"),COMPANY_TYPE:o.getCache("COMPANY_TYPE"),MCC_CODE:p.cached.MCC_CODE}},function(e){},"AddMerchantInfoModalInstanceCtrl","myModalNoFooter.html")}function g(e,n){var c=angular.copy(e);c.createTime=null,c.lastUpdTime=null,c.merchantOnlineDate=d(c.merchantOnlineDate,"yyyyMMdd"),c.openDate=d(c.openDate,"yyyyMMdd"),c.auditDate=d(c.auditDate,"yyyyMMdd"),c.merchantStatus=n,t.post(config.ctx+"/merchant/info/updateByStatus",a(c)).then(function(t){t.data.success?(e.merchantStatus=c.merchantStatus,alert("操作成功")):alert(t.data.msg)},function(e){alert("操作失败"),alert(e.status)})}function T(){if(1!=i.getChecked().length)return void alert("必须勾选一条记录！");var e,t,a,r,l,d=p.pagination.list.filter(function(c,o,d){if(c.merchantCode==i.getChecked()[0])return console.debug(c.merchantArea),n.debug(p.cached),e=p.cached.ALL_CITY.filter(function(e){if(c.merchantArea&&e.areaCode==c.merchantArea)return console.debug(e),!0})[0],t=e.citys.filter(function(e){if(c.cityCode&&e.cityCode==c.cityCode)return!0})[0],a=p.cached.MCC_CODE.filter(function(e){if(e.oValue==c.mccCode.substring(0,2))return!0})[0],a&&a.tList&&(r=a.tList.filter(function(e){if(e.tValue==c.mccCode.substring(2,4))return!0})[0]),console.log(r),r&&r.trList&&(l=r.trList.filter(function(e){if(e.trValue==c.mccCode.substring(4,6))return!0})[0]),!0})[0];console.log("ready to open second."),c({modalTitle:"修改用户",modalBody:"toUpdate",url:"update",item:d,pro:e,city:t,mccOne:a,mccTwo:r,mccThree:l,cached:{MERCHANT_CODE:o.getCache("MERCHANT_CODE"),ALL_CITY:p.cached.ALL_CITY,REPRT_TYPE:o.getCache("REPRT_TYPE"),CHK_DEAL_FLAG:o.getCache("CHK_DEAL_FLAG"),CHK_METHOD:o.getCache("CHK_METHOD"),CA_APPLY_STATE:o.getCache("CA_APPLY_STATE"),MCHNT_TYPE:o.getCache("MCHNT_TYPE"),COMPANY_TYPE:o.getCache("COMPANY_TYPE"),MCC_CODE:p.cached.MCC_CODE}},function(e){p.queryDetail()},"updateMerchantInfoModalInstanceCtrl","myModalNoFooter.html")}function f(){return 1!=i.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({userId:i.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=p.pagination.list.filter(function(e,t,a){return e.userId==i.getChecked()[0]})[0];p.pagination.list.splice(p.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var p=e.vm={};p.constant=u,p.pagination={pageSize:10,pageNum:1},p.queryBean={},p.cached={MERCHANT_CODE:{},MERCHANT_ABBR_NAME:{},MCHNT_STATUS:{},REPRT_TYPE:{},CHK_DEAL_FLAG:{},CHK_METHOD:{},CA_APPLY_STATE:{},MCHNT_TYPE:{},COMPANY_TYPE:{}},function(){o.getObj("ALL_CITY",function(e,t){p.cached.ALL_CITY=t}),o.getObj("MCC_CODE",function(e,t){p.cached.MCC_CODE=t}),o.initCaches(p.cached)}(),p.getCache=function(e){return o.getCache(e)},p.getObj=function(e,c){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return r(l(e.data.object,c),6)},function(e){n.error("获取数据%s失败",cacheKey)})},p.queryDetail=C,p.resetForm=s,p.updateChecked=m,p.addItem=h,p.updateItem=T,p.deleteItem=f,p.updateItemEnableFlag=g}]),angular.module("myApp").controller("AddMerchantInfoModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","dateFilter","$log","myConstant",function(e,t,a,n,c,i,o,r){var l=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};l=e.vm=a,l.constant=r,e.save=function(){var e=angular.copy(l.item);e.merchantOnlineDate=i(e.merchantOnlineDate,"yyyyMMdd"),n.post(l.url,c(e)).then(function(e){e.data.success?(alert("操作成功"),t.close(l.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("myApp").controller("updateMerchantInfoModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","$log","dateFilter","myConstant",function(e,t,a,n,c,i,o,r){var l=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};e.vm.item.mccOne="10",console.log(a),l=e.vm=a,l.constant=r,e.save=function(){var e=angular.copy(l.item);e.merchantOnlineDate=o(e.merchantOnlineDate,"yyyyMMdd"),e.createTime=null,e.lastUpdTime=null,e.openDate=null,e.auditDate=null,i.debug(l.postData),n.post(l.url,c(e)).then(function(e){e.data.success?(alert("操作成功"),t.close(l.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}}]);