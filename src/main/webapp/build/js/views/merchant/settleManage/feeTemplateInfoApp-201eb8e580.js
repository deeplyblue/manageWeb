angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","myConstant",function(e,t,a,o,i,s,l,m,p,n){function L(){var e=document.getElementById("queryForm");u.url=angular.element(e).prop("action");var o=u.queryBean;o.pageSize=u.pagination.pageSize,o.pageNum=u.pagination.pageNum,t.post(u.url,a(o)).then(function(e){var t=e.data;t.success?(u.pagination=t.object,s.clearChecked()):alert(t.msg)})}function g(){u.queryBean={},u.queryBean.companyType="03"}function f(e,t){s.updateChecked(e,t),o.debug(t),o.debug(s.getChecked())}function d(){i({modalTitle:"增加手续费模板信息",modalBody:"toAdd",url:"addCfgTemp",tempSize:new Array(1),item:{},cached:{BANK_INFO:u.getCache("BANK_INFO"),BANK_CARD_TYPE:u.getCache("BANK_CARD_TYPE"),MCHNT_TRANS_CODE:u.getCache("MCHNT_TRANS_CODE"),MERCHANT_CODE:u.getCache("MERCHANT_CODE"),CONN_CHANNEL:u.getCache("CONN_CHANNEL")}},function(e){u.queryDetail()},"privateMerchantFeeCfgCtrl","myModalNoFooter.html")}function r(){if(1!=s.getCheckedNew(u.pagination.list).length)return void alert("必须勾选一条记录！");var e=s.getCheckedNew(u.pagination.list)[0];i({modalTitle:"修改手续费模板信息",modalBody:"toUpdate",url:"updateCfgTemp",item:e,tempSize:new Array(1),cached:{BANK_INFO:u.getCache("BANK_INFO"),BANK_CARD_TYPE:u.getCache("BANK_CARD_TYPE"),MCHNT_TRANS_CODE:u.getCache("MCHNT_TRANS_CODE"),MERCHANT_CODE:u.getCache("MERCHANT_CODE"),CONN_CHANNEL:u.getCache("CONN_CHANNEL")}},function(e){u.queryDetail()},"privateUpdateMerchantFeeCfgCtrl","myModalNoFooter.html")}function c(){return 1!=s.getCheckedNew(u.pagination.list).length?void alert("必须勾选一条记录！"):void t.post("delete",a({userId:s.getCheckedNew(u.pagination.list)[0].userId})).then(function(e){var t=e.data;t.success?(u.pagination.list.splice(u.pagination.list.indexOf(s.getCheckedNew(u.pagination.list)[0]),1),alert("操作成功")):alert("操作失败")},function(e){alert(e.statusText),o.debug("error")})}var u=e.vm={};u.constant=n,u.pagination={pageSize:10,pageNum:1},u.queryBean={},u.cached={BANK_INFO:{},BANK_CARD_TYPE:{},MCHNT_TRANS_CODE:{},MERCHANT_CODE:{},CONN_CHANNEL:{}},l.initCache(u.cached),u.getCache=function(e){return l.getCache(e)},u.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return m(p(e.data.object,i),6)},function(e){o.error("获取数据%s失败",cacheKey)})},u.queryDetail=L,u.resetForm=g,u.updateChecked=f,u.addItem=d,u.updateItem=r,u.deleteItem=c}]),angular.module("myApp").controller("privateUpdateMerchantFeeCfgCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","$log","$timeout","dateFilter","myConstant",function(e,t,a,o,i,s,l,m,p){var n=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};n=e.vm=a,n.constant=p,n.tempParams={},n.validateOptions={blurTrig:!0,showError:function(e,t){},removeError:!0},function(){var e=n.item.feeSegRateModelList.length;n.tempParams.feeSegCount=e}(),n.appendSizeFun=function(){if(n.tempParams.feeSegCount){n.item.feeSegRateModelList=[];for(var e=0;e<n.tempParams.feeSegCount;e++)n.item.feeSegRateModelList.push({segLowLmt:"",orderSeq:e+1});n.item.feeSegRateModelList[0].segLowLmt="0",n.item.feeSegRateModelList[Number(n.tempParams.feeSegCount)-1].segUppLmt="99999999999999999"}},e.save=function(){n.postData=angular.copy(n.item),s.info("------------"+JSON.stringify(n.postData));for(var e in n.postData.feeSegRateModelList)"01"==n.postData.feeUnit&&(n.postData.feeSegRateModelList[e].segLowLmt=100*n.postData.feeSegRateModelList[e].segLowLmt,n.postData.feeSegRateModelList[e].segUppLmt=100*n.postData.feeSegRateModelList[e].segUppLmt),"01"==n.postData.feeSegRateModelList[e].feeSegMethod?(n.postData.feeSegRateModelList[e].feeLowLmt="",n.postData.feeSegRateModelList[e].feeUppLmt=""):"02"==n.postData.feeSegRateModelList[e].feeSegMethod&&(n.postData.feeSegRateModelList[e].feeLowLmt=100*n.postData.feeSegRateModelList[e].feeLowLmt,n.postData.feeSegRateModelList[e].feeUppLmt=100*n.postData.feeSegRateModelList[e].feeUppLmt);var a={headers:{"Content-Type":"application/json"}};o.post(n.url,n.postData,a).then(function(e){e.data.success?(alert("操作成功"),t.close(n.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")},n.checkFeeUppLmt=function(e){n.item.feeSegRateModelList[e].feeUppLmt.match(/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/)||(n.item.feeSegRateModelList[e].feeUppLmt=null),n.item.feeSegRateModelList[e].feeLowLmt.match(/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/)||(n.item.feeSegRateModelList[e].feeLowLmt=null);var t=parseFloat(n.item.feeSegRateModelList[e].feeUppLmt),a=parseFloat(n.item.feeSegRateModelList[e].feeLowLmt);t>a||(n.item.feeSegRateModelList[e].feeUppLmt=null)},n.checkFeeLowLmt=function(e){n.item.feeSegRateModelList[e].feeLowLmt.match(/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/)||(n.item.feeSegRateModelList[e].feeLowLmt=null);var t=parseFloat(n.item.feeSegRateModelList[e].feeUppLmt),a=parseFloat(n.item.feeSegRateModelList[e].feeLowLmt);t>a||(n.item.feeSegRateModelList[e].feeUppLmt=null)},n.checkUppLmtAmt=function(e){n.item.feeSegRateModelList[e].segUppLmt.match(/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/)||(n.item.feeSegRateModelList[e].segUppLmt=null);var t=parseFloat(n.item.feeSegRateModelList[e].segUppLmt),a=parseFloat(n.item.feeSegRateModelList[e].segLowLmt);t>a?n.item.feeSegRateModelList[e+1].segLowLmt=n.item.feeSegRateModelList[e].segUppLmt:n.item.feeSegRateModelList[e].segUppLmt=null};for(var L in n.item.feeSegRateModelList)"01"==n.item.feeUnit&&(n.item.feeSegRateModelList[L].segLowLmt=n.item.feeSegRateModelList[L].segLowLmt/100,n.item.feeSegRateModelList[L].segUppLmt=n.item.feeSegRateModelList[L].segUppLmt/100)}]),angular.module("myApp").controller("privateMerchantFeeCfgCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","$log","$timeout","dateFilter","myConstant",function(e,t,a,o,i,s,l,m,p){var n=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};n=e.vm=a,n.constant=p,n.validateOptions={blurTrig:!0,showError:function(e,t){},removeError:!0},function(){n.item.feeSegRateModelList=[];for(var e=0;e<1;e++)n.item.feeSegRateModelList.push({segLowLmt:"",orderSeq:e+1});n.item.feeSegRateModelList[0].segLowLmt="0",n.item.feeSegRateModelList[0].segUppLmt="9999999999999"}(),n.appendSizeFun=function(){if(n.tempParams.feeSegCount){n.item.feeSegRateModelList=[];for(var e=0;e<n.tempParams.feeSegCount;e++)n.item.feeSegRateModelList.push({segLowLmt:"",orderSeq:e+1});n.item.feeSegRateModelList[0].segLowLmt="0",n.item.feeSegRateModelList[Number(n.tempParams.feeSegCount)-1].segUppLmt="99999999999999999"}},e.save=function(){n.postData=angular.copy(n.item),s.info("------------"+JSON.stringify(n.postData));for(var e in n.postData.feeSegRateModelList)"01"==n.postData.feeUnit&&(n.postData.feeSegRateModelList[e].segLowLmt=100*n.postData.feeSegRateModelList[e].segLowLmt,n.postData.feeSegRateModelList[e].segUppLmt=100*n.postData.feeSegRateModelList[e].segUppLmt),"01"==n.postData.feeSegRateModelList[e].feeSegMethod?(n.postData.feeSegRateModelList[e].feeLowLmt="",n.postData.feeSegRateModelList[e].feeUppLmt=""):"02"==n.postData.feeSegRateModelList[e].feeSegMethod&&(n.postData.feeSegRateModelList[e].feeLowLmt=100*n.postData.feeSegRateModelList[e].feeLowLmt,n.postData.feeSegRateModelList[e].feeUppLmt=100*n.postData.feeSegRateModelList[e].feeUppLmt);var a={headers:{"Content-Type":"application/json"}};o.post(n.url,n.postData,a).then(function(e){e.data.success?(alert("操作成功"),t.close(n.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")},n.checkFeeUppLmt=function(e){n.item.feeSegRateModelList[e].feeUppLmt.match(/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/)||(n.item.feeSegRateModelList[e].feeUppLmt=null),n.item.feeSegRateModelList[e].feeLowLmt.match(/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/)||(n.item.feeSegRateModelList[e].feeLowLmt=null);var t=parseFloat(n.item.feeSegRateModelList[e].feeUppLmt),a=parseFloat(n.item.feeSegRateModelList[e].feeLowLmt);t>a||(n.item.feeSegRateModelList[e].feeUppLmt=null)},n.checkFeeLowLmt=function(e){n.item.feeSegRateModelList[e].feeLowLmt.match(/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/)||(n.item.feeSegRateModelList[e].feeLowLmt=null);var t=parseFloat(n.item.feeSegRateModelList[e].feeUppLmt),a=parseFloat(n.item.feeSegRateModelList[e].feeLowLmt);t>a||(n.item.feeSegRateModelList[e].feeUppLmt=null)},n.checkUppLmtAmt=function(e){n.item.feeSegRateModelList[e].segUppLmt.match(/^(([1-9]\d{0,9})|0)(\.\d{1,2})?$/)||(n.item.feeSegRateModelList[e].segUppLmt=null);var t=parseFloat(n.item.feeSegRateModelList[e].segUppLmt),a=parseFloat(n.item.feeSegRateModelList[e].segLowLmt);t>a?n.item.feeSegRateModelList[e+1].segLowLmt=n.item.feeSegRateModelList[e].segUppLmt:n.item.feeSegRateModelList[e].segUppLmt=null}}]);