angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","myConstant",function(e,t,a,c,n,o,l,r){function C(){var e=document.getElementById("queryForm");R.url=angular.element(e).prop("action");var c=R.queryBean;c.pageSize=R.pagination.pageSize,c.pageNum=R.pagination.pageNum,t.post(R.url,a(c)).then(function(e){var t=e.data;t.success?(R.pagination=t.object,o.clearChecked()):alert(t.msg)})}function i(){R.queryBean={},R.queryBean.companyType="03"}function d(e,t){o.updateChecked(e,t),c.debug(t),c.debug(o.getChecked())}function u(e){var t=angular.copy(e);if(t.clrPointDesc="","03"==t.clrCycle||"04"==t.clrCycle){var a=R.getCache("CLEAR_VALUE_POINT");a.forEach(function(e){e.value==t.clrPoint&&(t.clrPointDesc=e.key)})}else if("02"==t.clrCycle||"05"==t.clrCycle){var a=R.getCache("CLEAR_VALUE_POINT_WEEK");a.forEach(function(e){e.value==t.clrPoint&&(t.clrPointDesc=e.key)})}n({modalTitle:"查看明细",modalBody:"toDetail",url:"#",item:t,cached:{MERCHANT_CODE:R.cached.MERCHANT_CODE,CLR_CYCLE:R.cached.CLR_CYCLE,REPORT_TYPE:R.cached.REPORT_TYPE,CLR_TYPE:R.cached.CLR_TYPE,FEE_CLEAR_TYPE:R.cached.FEE_CLEAR_TYPE,CLR_RANGE:R.cached.CLR_RANGE,CLEAR_VALUE_POINT:R.cached.CLEAR_VALUE_POINT,CLEAR_VALUE_POINT_WEEK:R.cached.CLEAR_VALUE_POINT_WEEK,CLR_RULES_1:R.cached.CLR_RULES_1,CLR_RULES_2:R.cached.CLR_RULES_2,COMANY_CODE:R.cached.COMANY_CODE}},function(e){},"","myModalNoSave.html")}function E(){n({modalTitle:"新增商户结算信息",modalBody:"toAdd",url:"add",item:{},cached:{MERCHANT_CODE:R.getCache("MERCHANT_CODE"),CLR_CYCLE:R.cached.CLR_CYCLE,REPORT_TYPE:R.cached.REPORT_TYPE,CLR_TYPE:R.cached.CLR_TYPE,FEE_CLEAR_TYPE:R.cached.FEE_CLEAR_TYPE,CLR_RANGE:R.cached.CLR_RANGE,CLEAR_VALUE_POINT:R.cached.CLEAR_VALUE_POINT,CLEAR_VALUE_POINT_WEEK:R.cached.CLEAR_VALUE_POINT_WEEK,CLR_RULES_1:R.cached.CLR_RULES_1,CLR_RULES_2:R.cached.CLR_RULES_2,COMANY_CODE:R.getCache("COMANY_CODE")}},function(e){},"addMerchantClearCfgApp","myModalNoFooter.html")}function p(e,a,n){var o={id:e.id};a&&(o.auditStatus=a),n&&(o.enableFlag=n),t.post(config.ctx+"/merchant/clearCfg/updateItemEnableFlag",o,config.jsonHeader).then(function(t){var c=t.data;c.success?(a&&(e.auditStatus=a),n&&(e.enableFlag=n),alert("操作成功"),R.queryDetail()):alert("操作失败")},function(e){alert(e.statusText),c.debug("error")})}function s(){if(1!=o.getCheckedNew(R.pagination.list).length)return void alert("必须勾选一条记录！");var e=o.getCheckedNew(R.pagination.list)[0];e.createTime=null,e.lastUpdTime=null,e.auditDate=null,c.debug("temp:",e),n({modalTitle:"修改商户结算信息",modalBody:"toUpdate",url:"update",item:e,cached:{MERCHANT_CODE:R.getCache("MERCHANT_CODE"),CLR_CYCLE:R.cached.CLR_CYCLE,REPORT_TYPE:R.cached.REPORT_TYPE,CLR_TYPE:R.cached.CLR_TYPE,FEE_CLEAR_TYPE:R.cached.FEE_CLEAR_TYPE,CLR_RANGE:R.cached.CLR_RANGE,CLEAR_VALUE_POINT:R.cached.CLEAR_VALUE_POINT,CLEAR_VALUE_POINT_WEEK:R.cached.CLEAR_VALUE_POINT_WEEK,CLR_RULES_1:R.cached.CLR_RULES_1,CLR_RULES_2:R.cached.CLR_RULES_2,COMANY_CODE:R.getCache("COMANY_CODE")}},function(){R.queryDetail()},"updateMerchantClearCfgApp","myModalNoFooter.html")}function m(){return 1!=o.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:o.getCheckedNew(R.pagination.list)[0].id})).then(function(e){var t=e.data;if(t.success){R.pagination.list.filter(function(e,t,a){return e.id==o.getChecked()[0]})[0];R.pagination.list.splice(R.pagination.list.indexOf(o.getCheckedNew(R.pagination.list)[0]),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),c.debug("error")})}var R=e.vm={};R.constant=r,R.pagination={pageSize:10,pageNum:1},R.queryBean={},R.queryDetail=C,R.resetForm=i,R.queryCleearCfgDetail=u,R.updateChecked=d,R.addItem=E,R.updateItem=s,R.deleteItem=m,R.updateItemEnableFlag=p,R.cached={MERCHANT_CODE:{},CLR_CYCLE:{},REPORT_TYPE:{},CLR_TYPE:{},FEE_CLEAR_TYPE:{},ENABLE_FLAG:{},CLR_RANGE:{},CLEAR_VALUE_POINT:{},CLEAR_VALUE_POINT_WEEK:{},CLR_RULES_1:{},CLR_RULES_2:{},COMANY_CODE:{}},l.initCache(R.cached),R.getCache=function(e){return l.getCache(e)}}]),angular.module("myApp").controller("addMerchantClearCfgApp",function(e,t,a,c,n,o,l){console.log("test");var r=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};r=e.vm=a,r.constant=l,r.companyBank=[],r.companyBank[0]={companyCode:"",clrPoint:"",clrCycle:"",clrRange:""},r.addCompanyBank=function(e){console.log("addCompanyBank"),r.companyBank.push({companyCode:"",clrPoint:"",clrCycle:"",clrRange:""})},r.deleteCompanyBank=function(e){0==e?alert("第一条信息不能删除!"):r.companyBank.remove(e)},r.companyRout=[],r.companyRout[0]={companyCode:"",propNum:""},r.addCompanyRout=function(e){console.log("addCompanyRout"),r.companyRout.push({companyCode:"",propNum:""})},r.deleteCompanyRout=function(e){0==e?alert("第一条信息不能删除!"):r.companyRout.remove(e)},r.companyProfit=[],r.companyProfit[0]={companyCode:"",propNum:""},r.addCompanyProfit=function(e){console.log("addCompanyProfit"),r.companyProfit.push({companyCode:"",propNum:""})},r.deleteCompanyProfit=function(e){0==e?alert("第一条信息不能删除!"):r.companyProfit.remove(e)},Array.prototype.remove=function(e){if(isNaN(e)||e>this.length)return!1;for(var t=0,a=0;t<this.length;t++)this[t]!=this[e]&&(this[a++]=this[t]);this.length-=1},e.save=function(){var e=r.item;o.debug("vm.item.clrRules---------",r.item.clrRules),1==r.item.clrRules?e.bankClearCfgList=r.companyBank:2==r.item.clrRules?e.accountClearCfgList=r.companyRout:3==r.item.clrRules&&(e.propClearCfgList=r.companyProfit),o.debug("postData---------",e,"--------postData"),c.post(r.url,e,config.jsonHeader).then(function(e){e.data.success?(alert("操作成功"),t.close(r.item)):""!=e.data.msg?alert(e.data.msg):alert("新增失败")},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}}),angular.module("myApp").controller("updateMerchantClearCfgApp",function(e,t,a,c,n,o,l){var r=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};r=e.vm=a,r.constant=l,""!=r.item.bankClearCfgList&&null!=r.item.bankClearCfgList||r.item.bankClearCfgList.push({companyCode:"",clrPoint:"",clrCycle:"",clrRange:""}),r.addCompanyBank=function(e){r.item.bankClearCfgList.push({companyCode:"",clrPoint:"",clrCycle:"",clrRange:""})},r.deleteCompanyBank=function(e){0==e?alert("第一条信息不能删除!"):r.item.bankClearCfgList.remove(e)},""!=r.item.accountClearCfgList&&null!=r.item.accountClearCfgList||r.item.accountClearCfgList.push({companyCode:"",propNum:""}),r.addCompanyRout=function(e){r.item.accountClearCfgList.push({companyCode:"",propNum:""})},r.deleteCompanyRout=function(e){0==e?alert("第一条信息不能删除!"):r.item.accountClearCfgList.remove(e)},""!=r.item.propClearCfgList&&null!=r.item.propClearCfgList||r.item.propClearCfgList.push({companyCode:"",propNum:""}),r.addCompanyProfit=function(e){r.item.propClearCfgList.push({companyCode:"",propNum:""})},r.deleteCompanyProfit=function(e){0==e?alert("第一条信息不能删除!"):r.item.propClearCfgList.remove(e)},Array.prototype.remove=function(e){if(isNaN(e)||e>this.length)return!1;for(var t=0,a=0;t<this.length;t++)this[t]!=this[e]&&(this[a++]=this[t]);this.length-=1},e.save=function(){o.debug("vm.item.clrRules---------",r.item.clrRules);var e=r.item;1==e.clrType&&(e.clrRules=null),1==e.clrRules?(delete e.accountClearCfgList,delete e.propClearCfgList,delete e.clearKey,delete e.$$hashKey):2==e.clrRules?(delete e.bankClearCfgList,delete e.propClearCfgList,delete e.clearKey,delete e.$$hashKey):3==e.clrRules?(delete e.accountClearCfgList,delete e.bankClearCfgList,delete e.clearKey,delete e.$$hashKey):null==e.clrRules&&(delete e.accountClearCfgList,delete e.bankClearCfgList,delete e.propClearCfgList,delete e.clearKey,delete e.$$hashKey),o.debug("postDate:",e),c.post(r.url,e,config.jsonHeader).then(function(e){e.data.success?(alert("操作成功"),t.close(r.item)):""!=e.data.msg?alert(e.data.msg):alert("新增失败")},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}});