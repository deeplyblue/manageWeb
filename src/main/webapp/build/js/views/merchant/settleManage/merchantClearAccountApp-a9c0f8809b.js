angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,t,a,n,c,i,o,r,u,d,l){function g(){var e=document.getElementById("queryForm");f.url=angular.element(e).prop("action");var n=f.queryBean;n.pageSize=f.pagination.pageSize,n.pageNum=f.pagination.pageNum,t.post(f.url,a(n)).then(function(e){var t=e.data;t.success?(f.pagination=t.object,i.clearChecked()):alert(t.msg)})}function C(){f.queryBean={},f.queryBean.companyType="03"}function h(e,t){i.updateChecked(e,t),n.debug(t),n.debug(i.getChecked())}function p(){c({modalTitle:"增加商户账户信息",modalBody:"toAdd",url:"add",item:{},cached:{MERCHANT_CODE:o.getCache("MERCHANT_CODE"),ALL_AREA:f.cached.ALL_AREA,ORG_BANK_CODE_DESC:o.getCache("ORG_BANK_CODE_DESC")}},function(){},"","myModalNoFooter.html")}function A(){if(1!=i.getChecked().length)return void alert("必须勾选一条记录！");var e=f.pagination.list.filter(function(e,t,a){if(e.id==i.getChecked()[0])return!0})[0];c({modalTitle:"修改商户账户信息",modalBody:"toUpdate",url:"update",item:e,cached:{MERCHANT_CODE:f.cached.MERCHANT_CODE,ALL_AREA:f.cached.ALL_AREA,ORG_BANK_CODE_DESC:o.getCache("ORG_BANK_CODE_DESC")}},function(){},"","myModalNoFooter.html")}function m(){return 1!=i.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({userId:i.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=f.pagination.list.filter(function(e,t,a){return e.userId==i.getChecked()[0]})[0];f.pagination.list.splice(f.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var f=e.vm={};f.constant=l,f.pagination={pageSize:10,pageNum:1},f.queryBean={},f.cached={MERCHANT_CODE:{},ORG_BANK_CODE_DESC:{}},function(){o.initCache(f.cached),o.getObj("ALL_AREA",function(e,t){n.debug(t),f.cached.ALL_AREA=t})}(),f.getCache=function(e){return o.getCache(e)},f.getObj=function(e,c){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return r(u(e.data.object,c),6)},function(e){n.error("获取数据%s失败",cacheKey)})},f.queryDetail=g,f.resetForm=C,f.updateChecked=h,f.addItem=p,f.updateItem=A,f.deleteItem=m}]);