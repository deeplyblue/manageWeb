angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","dateFilter","myConstant",function(e,t,a,n,i,d,r,o,c){function l(){var e=document.getElementById("queryForm");C.url=angular.element(e).prop("action");var n=angular.copy(C.queryBean);n.pageSize=C.pagination.pageSize,n.pageNum=C.pagination.pageNum,n.contBgnDate=o(n.contBgnDate,"yyyyMMdd"),n.contEndDate=o(n.contEndDate,"yyyyMMdd"),t.post(C.url,a(n)).then(function(e){var t=e.data;t.success?(C.pagination=t.object,d.clearChecked()):alert(t.msg)})}function f(e){location.href=config.ctx+"/merchant/merchantContaract/downEnclosure?id="+e.id}function s(e,a){var i=angular.copy(e);i.auditStatus=a,t.post(config.ctx+"/merchant/merchantContaract/updateItemEnableFlag",i,config.jsonHeader).then(function(t){var n=t.data;n.success?(e.auditStatus=a,alert("操作成功")):alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}function u(){C.queryBean={}}function g(e,t){d.updateChecked(e,t),n.debug(t),n.debug(d.getChecked())}function m(){i({modalTitle:"新增合同信息",modalBody:"toAdd",url:"add",item:{},cached:{MERCHANT_CODE:r.getCache("MERCHANT_CODE")}},function(e){l()},"AddContractModalInstanceCtrl","myModalNoFooter.html")}function p(){if(1!=d.getCheckedNew(C.pagination.list).length)return void alert("必须勾选一条记录！");var e=d.getCheckedNew(C.pagination.list)[0];if(null!=e.dfsContAttach&&""!=e.dfsContAttach){var a=config.ctx+"/merchant/contaract/getDfs?id="+e.dfsContAttach;t.get(a).success(function(t){e.dfsInfo=t.object})}if(null!=e.dfsOpenBankCert&&""!=e.dfsOpenBankCert){var a=config.ctx+"/merchant/contaract/getDfs?id="+e.dfsOpenBankCert;t.get(a).success(function(t){e.dfsInfo1=t.object})}if(null!=e.dfsRatePayerCert&&""!=e.dfsRatePayerCert){var a=config.ctx+"/merchant/contaract/getDfs?id="+e.dfsRatePayerCert;t.get(a).success(function(t){e.dfsInfo2=t.object})}if(null!=e.dfsTaxRegisterCert&&""!=e.dfsTaxRegisterCert){var a=config.ctx+"/merchant/contaract/getDfs?id="+e.dfsTaxRegisterCert;t.get(a).success(function(t){e.dfsInfo3=t.object})}if(null!=e.dfsBizLicenseCert&&""!=e.dfsBizLicenseCert){var a=config.ctx+"/merchant/contaract/getDfs?id="+e.dfsBizLicenseCert;t.get(a).success(function(t){e.dfsInfo4=t.object})}if(null!=e.dfsOrganizationCodeCert&&""!=e.dfsOrganizationCodeCert){var a=config.ctx+"/merchant/contaract/getDfs?id="+e.dfsOrganizationCodeCert;t.get(a).success(function(t){e.dfsInfo5=t.object})}if(null!=e.dfsBankFile&&""!=e.dfsBankFile){var a=config.ctx+"/merchant/contaract/getDfs?id="+e.dfsBankFile;t.get(a).success(function(t){e.dfsInfo6=t.object})}i({modalTitle:"修改合同信息",modalBody:"toUpdate",url:"update",item:e,cached:{MERCHANT_CODE:r.getCache("MERCHANT_CODE")}},function(e){l(),n.debug(e)},"updateContractModalInstanceCtrl","myModalNoFooter.html")}function y(){return 1!=d.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:d.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=C.pagination.list.filter(function(e,t,a){return e.id==d.getChecked()[0]})[0];C.pagination.list.splice(C.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var C=e.vm={};C.constant=c,C.pagination={pageSize:10,pageNum:1},C.queryBean={},C.queryDetail=l,C.resetForm=u,C.updateChecked=g,C.addItem=m,C.updateItem=p,C.deleteItem=y,C.updateItemEnableFlag=s,C.downEnclosure=f,C.cached={MERCHANT_CODE:{},CONN_CHANNEL:{}},r.initCache(C.cached),C.getCache=function(e){return r.getCache(e)}}]),angular.module("myApp").controller("AddContractModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","FileUploader","dateFilter","$log","myConstant",function(e,t,a,n,i,d,r,o,c){var l=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};l=e.vm=a,l.constant=c,l.constant=c,l.fileItems=[{field:"dfsContAttach"},{field:"dfsOpenBankCert"},{field:"dfsRatePayerCert"},{field:"dfsTaxRegisterCert"},{field:"dfsBizLicenseCert"},{field:"dfsOrganizationCodeCert"},{field:"dfsBankFile"}],l.fileUploader=new d({url:config.ctx+"/system/fileUploader/upload",formData:[{busiType:"HT",remark:"商户合同"}],removeAfterUpload:!1,filters:[{name:"fileTypeFilter",fn:function(e){o.debug(e);var t=e.name.substring(e.name.lastIndexOf(".")+1);if(o.debug(t),!t||t.indexOf("pdf")==-1&&t.indexOf("rar")==-1&&t.indexOf("zip")==-1&&t.indexOf("jpg")==-1)return alert("文件类型不符：不是jpg/pdf/rar/zip类型！"),!1;o.debug("文件类型符合类型：jpg/pdf/rar/zip");var a=e.size;return a&&a<=10485760?(o.debug("文件大小符合：小于10M"),!0):(alert("文件大小不符：不允许超过10M的文件！"),!1)}}]}),l.fileUploader.onAfterAddingFile=function(e,t){l.fileUploader.queue.forEach(function(t){t.field==e.field&&t!=e&&l.fileUploader.removeFromQueue(t)})},l.fileUploader.onSuccessItem=function(e,t,a,n){t.object?(e.originFileName=e.file.name,e.dfsFullFilename=t.object.dfsFullFilename,e.dfsGroupName=t.object.dfsGroupName):(alert(t.msg),l.fileUploader.removeFromQueue(e))},e.save=function(){var e=angular.copy(l.item);e.contEndDate=r(e.contEndDate,"yyyyMMdd"),e.contBgnDate=r(e.contBgnDate,"yyyyMMdd"),e.contSignedDate=r(e.contSignedDate,"yyyyMMdd"),e.payerCertEndDate=r(e.payerCertEndDate,"yyyyMMdd"),e.taxRegisterEndDate=r(e.taxRegisterEndDate,"yyyyMMdd"),e.bizLicenseEndDate=r(e.bizLicenseEndDate,"yyyyMMdd"),l.fileUploader.queue.forEach(function(t){o.debug(t),t.isSuccess&&(e[t.field]=t.dfsFullFilename)}),n.post(l.url,i(e)).then(function(e){e.data.success?(alert("操作成功"),t.close(l.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("myApp").controller("updateContractModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","FileUploader","$httpParamSerializerJQLike","$log","dateFilter","myConstant",function(e,t,a,n,i,d,r,o,c){var l=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};l=e.vm=a,l.constant=c,l.fileItems=[{field:"dfsContAttach"},{field:"dfsOpenBankCert"},{field:"dfsRatePayerCert"},{field:"dfsTaxRegisterCert"},{field:"dfsBizLicenseCert"},{field:"dfsOrganizationCodeCert"},{field:"dfsBankFile"}],l.fileUploader=new i({url:config.ctx+"/system/fileUploader/upload",formData:[{busiType:"HT",remark:"支付机构合同"}],removeAfterUpload:!1,filters:[{name:"fileTypeFilter",fn:function(e){r.debug(e);var t=e.name.substring(e.name.lastIndexOf(".")+1);if(r.debug(t),!t||t.indexOf("pdf")==-1&&t.indexOf("rar")==-1&&t.indexOf("zip")==-1&&t.indexOf("jpg")==-1)return alert("文件类型不符：不是jpg/pdf/rar/zip类型！"),!1;r.debug("文件类型符合类型：jpg/pdf/rar/zip");var a=e.size;return a&&a<=10485760?(r.debug("文件大小符合：小于10M"),!0):(alert("文件大小不符：不允许超过10M的文件！"),!1)}}]}),l.fileUploader.onAfterAddingFile=function(e,t){l.fileUploader.queue.forEach(function(t){t.field==e.field&&t!=e&&l.fileUploader.removeFromQueue(t)})},l.fileUploader.onSuccessItem=function(e,t,a,n){t.object?(e.originFileName=e.file.name,e.dfsFullFilename=t.object.dfsFullFilename,e.dfsGroupName=t.object.dfsGroupName):(alert(t.msg),l.fileUploader.removeFromQueue(e))},e.save=function(){var e=angular.copy(l.item);e.createTime=null,e.lastUpdTime=null,e.contEndDate=o(e.contEndDate,"yyyyMMdd"),e.contBgnDate=o(e.contBgnDate,"yyyyMMdd"),e.contSignedDate=o(e.contSignedDate,"yyyyMMdd"),e.payerCertEndDate=o(e.payerCertEndDate,"yyyyMMdd"),e.taxRegisterEndDate=o(e.taxRegisterEndDate,"yyyyMMdd"),e.bizLicenseEndDate=o(e.bizLicenseEndDate,"yyyyMMdd"),l.fileUploader.queue.forEach(function(t){r.debug(t),t.isSuccess&&(e[t.field]=t.dfsFullFilename)}),r.debug(l.postData),n.post(l.url,d(e)).then(function(e){e.data.success?(alert("操作成功"),t.close(l.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}}]);