angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,t,a,n,i,o,c,r,l,d,u){function g(){var e=document.getElementById("queryForm");f.url=angular.element(e).prop("action");var n=angular.copy(f.queryBean);n.pageSize=f.pagination.pageSize,n.pageNum=f.pagination.pageNum,t.post(f.url,a(n)).then(function(e){var t=e.data;t.success?(f.pagination=t.object,o.clearChecked()):alert(t.msg)})}function p(){f.queryBean={}}function h(e,t){o.updateChecked(e,t),n.debug(t),n.debug(o.getChecked())}function m(){var e=new Date;e.setFullYear((new Date).getFullYear()+1),i({modalTitle:"增加结算点配置信息",modalBody:"toAdd",url:"add",item:{dataKeyValidDate:e,rsaKeyValidDate:e},cached:{MERCHANT_CODE:c.getCache("MERCHANT_CODE")}},function(e){g()},"","myModalNoFooter.html")}function s(){if(1!=o.getCheckedNew(f.pagination.list).length)return void alert("必须勾选一条记录！");var e=o.getCheckedNew(f.pagination.list)[0];i({modalTitle:"修改结算点配置信息",modalBody:"toUpdate",url:"update",item:e,cached:{MERCHANT_CODE:f.cached.MERCHANT_CODE}},function(e){g()},"","myModalNoFooter.html")}function C(){return 1!=o.getCheckedNew(f.pagination.list).length?void alert("必须勾选一条记录！"):void t.post(config.ctx+"/merchant/itCfg/point/delete",a({id:o.getCheckedNew(f.pagination.list)[0].id})).then(function(e){var t=e.data;t.success?(f.pagination.list.splice(f.pagination.list.indexOf(o.getCheckedNew(f.pagination.list)[0]),1),alert("操作成功")):alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var f=e.vm={};f.constant=u,f.pagination={pageSize:10,pageNum:1},f.queryBean={},f.cached={MERCHANT_CODE:{}},c.initCache(f.cached),f.getCache=function(e){return c.getCache(e)},f.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return r(l(e.data.object,i),6)},function(e){n.error("获取数据%s失败",cacheKey)})},f.queryDetail=g,f.resetForm=p,f.updateChecked=h,f.addItem=m,f.updateItem=s,f.deleteItem=C}]);