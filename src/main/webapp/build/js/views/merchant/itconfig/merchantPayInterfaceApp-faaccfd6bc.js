angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","myConstant",function(e,t,a,n,i,c,o,r,l,u){function d(){var e=document.getElementById("queryForm");m.url=angular.element(e).prop("action");var n=m.queryBean;n.pageSize=m.pagination.pageSize,n.pageNum=m.pagination.pageNum,t.post(m.url,a(n)).then(function(e){var t=e.data;t.success?(m.pagination=t.object,c.clearChecked()):alert(t.msg)})}function g(){m.queryBean={}}function h(e,t){c.updateChecked(e,t),n.debug(t),n.debug(c.getChecked())}function C(){i({modalTitle:"增加商户接口配置",modalBody:"toAdd",url:"add",item:{},cached:{MERCHANT_CODE:o.getCache("MERCHANT_CODE"),CONSUMPTION_PATTERNS:o.getCache("CONSUMPTION_PATTERNS")}},function(){},"","myModalNoFooter.html")}function p(){if(1!=c.getCheckedNew(m.pagination.list).length)return void alert("必须勾选一条记录！");var e=c.getCheckedNew(m.pagination.list)[0];i({modalTitle:"修改商户联系人",modalBody:"toUpdate",url:"update",item:e,cached:{MERCHANT_CODE:o.getCache("MERCHANT_CODE"),CONSUMPTION_PATTERNS:o.getCache("CONSUMPTION_PATTERNS")}},function(){},"","myModalNoFooter.html")}function s(){return 1!=c.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({userId:c.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=m.pagination.list.filter(function(e,t,a){return e.userId==c.getChecked()[0]})[0];m.pagination.list.splice(m.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var m=e.vm={};m.constant=u,m.pagination={pageSize:10,pageNum:1},m.queryBean={},m.reverseFlag={1:"正交易",0:"反交易"},m.splitRightFlag={0:"分账交易",1:"非分账交易"},m.cached={MERCHANT_CODE:{},CONSUMPTION_PATTERNS:{}},o.initCache(m.cached),m.getCache=function(e){return o.getCache(e)},m.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return r(l(e.data.object,i),6)},function(e){n.error("获取数据%s失败",cacheKey)})},m.queryDetail=d,m.resetForm=g,m.updateChecked=h,m.addItem=C,m.updateItem=p,m.deleteItem=s}]);