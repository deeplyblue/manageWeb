angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant","DateCalculateService",function(e,t,a,n,i,c,r,l,o,u,d,g){function m(){var e=document.getElementById("queryForm");h.url=angular.element(e).prop("action");var n=angular.copy(h.queryBean);n.pageSize=h.pagination.pageSize,n.pageNum=h.pagination.pageNum,n.beginDate=u(n.bateBegin,"yyyyMMdd"),n.endDate=u(n.endDate,"yyyyMMdd"),n.clrDateBegin=null,n.clrDateEnd=null,t.post(h.url,a(n)).then(function(e){var t=e.data;t.success?h.pagination=t.object:alert(t.msg)},function(e){alert("操作失败")})}function s(){h.queryBean={}}function y(e){var c;t.post(config.ctx+"/settlement/unityFunding/orgClearDetailAudit/queryAuditDetail",a({handleBatchNo:e})).then(function(t){var a=t.data;return a.success?(c=a.object,void i({modalTitle:"审核明细【"+e+"】",modalBody:"toAuditDetail",url:"#",item:c,cached:{PAY_REQ_FLAG:h.cached.PAY_REQ_FLAG,COMANY_CODE:h.cached.COMANY_CODE,CLR_TYPE:h.cached.CLR_TYPE,REPORT_TYPE:h.cached.REPORT_TYPE}},function(e){n.debug(e),h.queryDetail()},"OrgClearAuditDetailCtrl","myModalNoSave.html")):(alert("未找到相关数据"),!1)})}var h=e.vm={};h.constant=d,h.pagination={pageSize:10,pageNum:1},h.sumObject={},h.queryBean={},h.queryBean.bateBegin=g.getToday(),h.queryBean.endDate=g.getToday(),h.cached={PAY_REQ_FLAG:{},COMANY_CODE:{},CLR_TYPE:{},REPORT_TYPE:{}},r.initCache(h.cached),h.getCache=function(e){return r.getCache(e)},h.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return l(o(e.data.object,i),6)},function(e){n.error("获取数据%s失败",cacheKey)})},h.queryDetail=m,h.resetForm=s,h.toAuditDetail=y}]),angular.module("myApp").controller("OrgClearAuditDetailCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","$log",function(e,t,a,n,i,c){var r=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{},clrFlag:""};r=e.vm=a,r.audit=function(t,a){confirm("确认审核？")&&n.post(config.ctx+"/settlement/unityFunding/orgClearDetailAudit/audit",i({handleBatchNo:t,auditStatus:a})).then(function(t){var a=t.data;a.success?(alert("操作成功!"),e.cancel()):alert("操作失败!")},function(){alert("操作失败!")})},r.auditFail=function(t,a,i){if(confirm("确认审核？")){r.url=config.ctx+"/settlement/unityFunding/orgClearDetailAudit/auditFail";var c={};c.handleBatchNo=t,c.clrDate=a,c.clrType=i,n.post(r.url,c,config.jsonHeader).then(function(t){var a=t.data;a.success?(alert("操作成功!"),e.cancel()):alert("操作失败!")},function(){alert("操作失败!")})}},e.cancel=function(){t.dismiss("cancel")}}]);