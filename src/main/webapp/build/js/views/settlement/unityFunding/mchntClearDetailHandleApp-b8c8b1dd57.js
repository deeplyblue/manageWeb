angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant","growl","DateCalculateService",function(e,a,t,l,r,o,c,n,d,i,s,u,m){function p(){var e=document.getElementById("queryForm");F.url=angular.element(e).prop("action");var l=angular.copy(F.queryBean);l.pageSize=F.pagination.pageSize,l.pageNum=F.pagination.pageNum,l.beginDate=i(l.clrDateBegin,"yyyyMMdd"),l.endDate=i(l.clrDateEnd,"yyyyMMdd"),l.clrDateBegin=null,l.clrDateEnd=null,a.post(F.url,t(l)).then(function(e){var a=e.data;a.success?(F.pagination=a.object,F.sumObject=a.sumObject):alert(a.msg)},function(e){alert("操作失败")})}function C(){F.queryBean={}}function A(e,a){var t,o="按支付机构明细经办";return null==e.mchntPayOrgClearDetailModelList?(alert("未找到相关数据"),!1):(t=e,"003"==a&&(o="手续费"),r({modalTitle:o,modalBody:"toClearDetail",url:"#",item:t,flag:a,clrFlag:e.clrFlag,cached:{CLR_FLAG:F.cached.CLR_FLAG,MERCHANT_CODE:F.cached.MERCHANT_CODE,COMANY_CODE:F.cached.COMANY_CODE,REPORT_TYPE:F.cached.REPORT_TYPE,CLR_TYPE:F.cached.CLR_TYPE,CLR_ADJUST_FLAG:F.cached.CLR_ADJUST_FLAG}},function(e){l.debug(e),F.queryDetail()},"MchntClearHandleDetailCtrl","myModalNoFooter.html"),void 0)}function y(e){var o;a.post(config.ctx+"/settlement/unityFunding/mchntClearDetail/queryClearDetail",t({clrBatchNo:e.clrBatchNo,clrType:e.clrType,clrFlag:e.clrFlag,beginDate:i(F.queryBean.clrDateBegin,"yyyyMMdd"),endDate:i(F.queryBean.clrDateEnd,"yyyyMMdd")})).then(function(a){var t=a.data;return t.success?(o=t.object,void r({modalTitle:"结算明细【"+e.clrBatchNo+"】",modalBody:"toClearDetail",url:"#",item:o,clrFlag:e.clrFlag,cached:{CLR_FLAG:F.cached.CLR_FLAG,MERCHANT_CODE:F.cached.MERCHANT_CODE,COMANY_CODE:F.cached.COMANY_CODE,REPORT_TYPE:F.cached.REPORT_TYPE,CLR_TYPE:F.cached.CLR_TYPE,CLR_ADJUST_FLAG:F.cached.CLR_ADJUST_FLAG}},function(e){l.debug(e),F.queryDetail()},"MchntClearHandleDetailCtrl","myModalNoFooter.html")):(alert("未找到相关数据"),!1)})}function h(e,a){l.debug(e.mchntClearDetailSplitModelList);var t;if(null==e.mchntClearDetailSplitModelList)return alert("未找到相关数据"),!1;var o;"002"==a&&(o="按分账结算明细经办"),"003"==a&&(o="手续费经办"),t=e,r({modalTitle:o,modalBody:"toFeeDetail",url:"#",item:t,flag:a,clrFlag:e.clrFlag,cached:{CLR_FLAG:F.cached.CLR_FLAG,MERCHANT_CODE:F.cached.MERCHANT_CODE,COMANY_CODE:F.cached.COMANY_CODE,REPORT_TYPE:F.cached.REPORT_TYPE,CLR_TYPE:F.cached.CLR_TYPE,CLR_ADJUST_FLAG:F.cached.CLR_ADJUST_FLAG}},function(e){l.debug(e),F.queryDetail()},"MchntFeeHandleDetailCtrl","myModalNoFooter.html")}var F=e.vm={};F.constant=s,F.pagination={pageSize:10,pageNum:1},F.sumObject={},F.queryBean={},F.queryBean.clrDateBegin=m.getToday(),F.queryBean.clrDateEnd=m.getToday(),F.validateOptions={blurTrig:!0,showError:function(e,a){u.addErrorMessage(a)},removeError:!0},F.cached={CLR_FLAG:{},MERCHANT_CODE:{},REPORT_TYPE:{},COMANY_CODE:{},CLR_TYPE:{},CLR_ADJUST_FLAG:{}},c.initCache(F.cached),F.getCache=function(e){return c.getCache(e)},F.getObj=function(e,r){return a.post(config.ctx+"/base/cache/getAll",t({cacheKey:e})).then(function(e){return n(d(e.data.object,r),6)},function(e){l.error("获取数据%s失败",cacheKey)})},F.queryDetail=p,F.toPayHandle=A,F.resetForm=C,F.toClearOrFeeHandle=h,F.toClearDetail=y}]),angular.module("myApp").controller("MchntClearHandleDetailCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","$log","dateFilter","CheckboxService",function(e,a,t,l,r,o,c,n){function d(e){s(),e.transAmtP=parseFloat(e.transAmtP)+100*parseFloat(u.adjustModel.payableAmt),e.transCountP=parseFloat(e.transCountP)+parseFloat(u.adjustModel.payableCount),e.transAmtR=parseFloat(e.transAmtR)+100*parseFloat(u.adjustModel.receivableAmt),e.transCountR=parseFloat(e.transCountR)+parseFloat(u.adjustModel.receivableCount),e.feeAmtR=parseFloat(e.feeAmtR)+100*parseFloat(u.adjustModel.reFeeAmt),e.feeAmtP=parseFloat(e.feeAmtP)+100*parseFloat(u.adjustModel.feeAmt)}function i(e){s(),e.transAmtP=parseFloat(e.transAmtP)-100*parseFloat(u.adjustModel.payableAmt),e.transCountP=parseFloat(e.transCountP)-parseFloat(u.adjustModel.payableCount),e.transAmtR=parseFloat(e.transAmtR)-100*parseFloat(u.adjustModel.receivableAmt),e.transCountR=parseFloat(e.transCountR)-parseFloat(u.adjustModel.receivableCount),e.feeAmtR=parseFloat(e.feeAmtR)-100*parseFloat(u.adjustModel.reFeeAmt),e.feeAmtP=parseFloat(e.feeAmtP)-100*parseFloat(u.adjustModel.feeAmt)}function s(){angular.isNumber(u.adjustModel.payableAmt)||(u.adjustModel.payableAmt=0),angular.isNumber(u.adjustModel.receivableAmt)||(u.adjustModel.receivableAmt=0),angular.isNumber(u.adjustModel.reFeeAmt)||(u.adjustModel.reFeeAmt=0),angular.isNumber(u.adjustModel.feeAmt)||(u.adjustModel.feeAmt=0),angular.isNumber(u.adjustModel.payableCount)||(u.adjustModel.payableCount=0),angular.isNumber(u.adjustModel.receivableCount)||(u.adjustModel.receivableCount=0)}var u=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{},flag:"",clrFlag:""};u=e.vm=t,o.debug(u),u.adjustModel={},u.item.mchntPayOrgClearDetailModelList.forEach(function(e){e.collapse=!0}),u.checked=[],u.handleSome=function(){var a;if("003"!=u.flag){if(0==n.getCheckedNew(u.item.mchntPayOrgClearDetailModelList).length)return void alert("请选择记录！");a=angular.copy(u.item),a.mchntPayOrgClearDetailModelList=[],n.getCheckedNew(u.item.mchntPayOrgClearDetailModelList).forEach(function(e){var t={mchntCode:e.mchntCode,clrType:e.clrType,clrDate:e.clrDate,payOrgCode:e.payOrgCode,clrBatchNo:e.clrBatchNo,paySeq:e.paySeq};a.mchntPayOrgClearDetailModelList.push(t)})}"003"==u.flag&&(a=angular.copy(u.item),a.mchntPayOrgClearDetailModelList=[],u.item.mchntPayOrgClearDetailModelList.forEach(function(e){var t={mchntCode:e.mchntCode,clrType:e.clrType,clrDate:e.clrDate,payOrgCode:e.payOrgCode,clrBatchNo:e.clrBatchNo,paySeq:e.paySeq};a.mchntPayOrgClearDetailModelList.push(t)})),confirm("确认经办？")&&l.post(config.ctx+"/settlement/unityFunding/mchntClearDetail/handle",a,config.jsonHeader).then(function(a){var t=a.data;t.success?(alert("经办成功!"),e.cancel()):alert("经办失败!")},function(){alert("经办失败!")})},u.checkA=function(e){u.item.mchntPayOrgClearDetailModelList.forEach(function(a){null!=e.clrRules&&a.clrRules==e.clrRules&&(a._checked=e._checked)})},u.toggleAdjust=function(e){return 0==e.collapse?void(e.collapse=!0):(e.collapse=!1,void(u.adjustModel={}))},u.queryAdjust=function(e){return 0==e.collapse?(e.collapse=!0,void d(e)):(u.adjustModel.mchntCode=e.mchntCode,u.adjustModel.clrDate=e.clrDate,u.adjustModel.payOrgCode=e.payOrgCode,u.adjustModel.clrType=e.clrType,void l.post(config.ctx+"/settlement/unityFunding/mchntClearDetailAdjust/query",u.adjustModel,config.jsonHeader).then(function(a){var t=a.data;t.success?(u.adjustModel=t.object,i(e),e.collapse=!1):alert("系统忙,请稍后再试")},function(e){alert(e.data.msg)}))},u.saveAdjust=function(e,a){var t=angular.copy(a);isNaN(parseFloat(t.payableAmt))&&(t.payableAmt=0),isNaN(parseFloat(t.receivableAmt))&&(t.receivableAmt=0),isNaN(parseFloat(t.reFeeAmt))&&(t.reFeeAmt=0),isNaN(parseFloat(t.feeAmt))&&(t.feeAmt=0),isNaN(parseFloat(t.payableCount))&&(t.payableCount=0),isNaN(parseFloat(t.receivableCount))&&(t.receivableCount=0),t.payableAmt=100*t.payableAmt,t.receivableAmt=100*t.receivableAmt,t.reFeeAmt=100*t.reFeeAmt,t.feeAmt=100*t.feeAmt,t.clrNetAmt=t.payableAmt-t.receivableAmt,t.clrAmt=t.reFeeAmt-t.feeAmt,t.mchntCode=e.mchntCode,t.payOrgCode=e.payOrgCode,t.clrDate=e.clrDate,t.clrType=e.clrType,l.post(config.ctx+"/settlement/unityFunding/mchntClearDetailAdjust/save",t,config.jsonHeader).then(function(a){var t=a.data;t.success?(alert("保存成功！"),e.collapse=!0,e.clrAdjustFlag="02",d(e)):alert(t.msg)},function(e){alert("操作失败")})},e.save=function(){},e.cancel=function(){a.dismiss("cancel")}}]),angular.module("myApp").controller("MchntFeeHandleDetailCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","$log","dateFilter","CheckboxService",function(e,a,t,l,r,o,c,n){function d(e){s(),e.payableAmt=parseFloat(e.payableAmt)+100*parseFloat(u.adjustModel.payableAmt),e.payableCount=parseFloat(e.payableCount)+parseFloat(u.adjustModel.payableCount),e.receivableAmt=parseFloat(e.receivableAmt)+100*parseFloat(u.adjustModel.receivableAmt),e.receivableCount=parseFloat(e.receivableCount)+parseFloat(u.adjustModel.receivableCount),e.feeAmt=parseFloat(e.feeAmt)+100*parseFloat(u.adjustModel.reFeeAmt),e.reFeeAmt=parseFloat(e.reFeeAmt)+100*parseFloat(u.adjustModel.feeAmt)}function i(e){s(),e.payableAmt=parseFloat(e.payableAmt)-100*parseFloat(u.adjustModel.payableAmt),e.payableCount=parseFloat(e.payableCount)-parseFloat(u.adjustModel.payableCount),e.receivableAmt=parseFloat(e.receivableAmt)-100*parseFloat(u.adjustModel.receivableAmt),e.receivableCount=parseFloat(e.receivableCount)-parseFloat(u.adjustModel.receivableCount),e.feeAmt=parseFloat(e.feeAmt)-100*parseFloat(u.adjustModel.reFeeAmt),e.reFeeAmt=parseFloat(e.reFeeAmt)-100*parseFloat(u.adjustModel.feeAmt)}function s(){angular.isNumber(u.adjustModel.payableAmt)||(u.adjustModel.payableAmt=0),angular.isNumber(u.adjustModel.receivableAmt)||(u.adjustModel.receivableAmt=0),angular.isNumber(u.adjustModel.reFeeAmt)||(u.adjustModel.reFeeAmt=0),angular.isNumber(u.adjustModel.feeAmt)||(u.adjustModel.feeAmt=0),angular.isNumber(u.adjustModel.payableCount)||(u.adjustModel.payableCount=0),angular.isNumber(u.adjustModel.receivableCount)||(u.adjustModel.receivableCount=0)}var u=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{},flag:"",clrFlag:""};u=e.vm=t,u.adjustModel={},u.item.mchntClearDetailSplitModelList.forEach(function(e){e.collapse=!0}),u.handleSomeFee=function(){var a=angular.copy(u.item);a.mchntClearDetailSplitModelList=[],a.mchntPayOrgClearDetailModelList=[],u.item.mchntClearDetailSplitModelList.forEach(function(e){var t={mchntCode:e.mchntCode,clrType:e.clrType,clrDate:e.clrDate,mchntCodeSplit:e.mchntCodeSplit};a.mchntClearDetailSplitModelList.push(t)}),u.item.mchntPayOrgClearDetailModelList.forEach(function(e){var t={mchntCode:e.mchntCode,clrType:e.clrType,clrDate:e.clrDate,payOrgCode:e.payOrgCode,clrBatchNo:e.clrBatchNo,paySeq:e.paySeq};a.mchntPayOrgClearDetailModelList.push(t)}),confirm("确认经办？")&&l.post(config.ctx+"/settlement/unityFunding/mchntClearDetail/feeHandle",a,config.jsonHeader).then(function(a){var t=a.data;t.success?(alert("经办成功!"),e.cancel()):alert("经办失败!")},function(){alert("经办失败!")})},u.toggleAdjustFee=function(e){return 0==e.collapse?void(e.collapse=!0):(e.collapse=!1,void(u.adjustModel={}))},u.queryAdjustFee=function(e){return 0==e.collapse?(e.collapse=!0,void d(e)):(u.adjustModel.mchntCode=e.mchntCode,u.adjustModel.clrDate=e.clrDate,u.adjustModel.clrType=e.clrType,u.adjustModel.mchntCodeSplit=e.mchntCodeSplit,void l.post(config.ctx+"/settlement/unityFunding/mchntClearDetailAdjust/queryFee",u.adjustModel,config.jsonHeader).then(function(a){var t=a.data;t.success?(u.adjustModel=t.object,i(e),e.collapse=!1):alert("系统忙,请稍后再试")},function(e){alert(e.data.msg)}))},u.saveFeeAdjust=function(e,a){var t=angular.copy(a);isNaN(parseFloat(t.payableAmt))&&(t.payableAmt=0),isNaN(parseFloat(t.receivableAmt))&&(t.receivableAmt=0),isNaN(parseFloat(t.reFeeAmt))&&(t.reFeeAmt=0),isNaN(parseFloat(t.feeAmt))&&(t.feeAmt=0),isNaN(parseFloat(t.payableCount))&&(t.payableCount=0),isNaN(parseFloat(t.receivableCount))&&(t.receivableCount=0),t.payableAmt=100*t.payableAmt,t.receivableAmt=100*t.receivableAmt,t.reFeeAmt=100*t.reFeeAmt,t.feeAmt=100*t.feeAmt,t.clrNetAmt=t.payableAmt-t.receivableAmt,t.clrAmt=t.reFeeAmt-t.feeAmt,t.mchntCode=e.mchntCode,t.clrDate=e.clrDate,t.clrType=e.clrType,t.mchntCodeSplit=e.mchntCodeSplit,l.post(config.ctx+"/settlement/unityFunding/mchntClearDetailAdjust/saveFee",t,config.jsonHeader).then(function(a){var t=a.data;t.success?(alert("保存成功！"),e.collapse=!0,e.clrAdjustFlag="02",d(e)):alert(t.msg)},function(e){alert("操作失败")})},e.save=function(){},e.cancel=function(){a.dismiss("cancel")}}]);