angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant","DateCalculateService",function(e,t,a,n,c,i,l,r,u,o,d,m){function g(){var e=document.getElementById("queryForm");y.url=angular.element(e).prop("action");var n=angular.copy(y.queryBean);n.pageSize=y.pagination.pageSize,n.pageNum=y.pagination.pageNum,n.beginDate=o(n.bateBegin,"yyyyMMdd"),n.endDate=o(n.endDate,"yyyyMMdd"),n.clrDateBegin=null,n.clrDateEnd=null,t.post(y.url,a(n)).then(function(e){var t=e.data;t.success?y.pagination=t.object:alert(t.msg)},function(e){alert("操作失败")})}function h(){y.queryBean={}}function s(e){var i;t.post(config.ctx+"/settlement/unityFunding/mchntClearDetailAudit/queryAuditDetail",a({handleBatchNo:e})).then(function(t){var a=t.data;return a.success?(i=a.object,void c({modalTitle:"审核明细【"+e+"】",modalBody:"toAuditDetail",url:"#",item:i,cached:{PAY_REQ_FLAG:y.cached.PAY_REQ_FLAG,MERCHANT_CODE:y.cached.MERCHANT_CODE,CLR_TYPE:y.cached.CLR_TYPE,REPORT_TYPE:y.cached.REPORT_TYPE,COMANY_CODE:y.cached.COMANY_CODE}},function(e){n.debug(e),y.queryDetail()},"MchntClearAuditDetailCtrl","myModalNoSave.html")):(alert("未找到相关数据"),!1)})}var y=e.vm={};y.constant=d,y.pagination={pageSize:10,pageNum:1},y.sumObject={},y.queryBean={},y.queryBean.bateBegin=m.getToday(),y.queryBean.endDate=m.getToday(),y.cached={PAY_REQ_FLAG:{},MERCHANT_CODE:{},CLR_TYPE:{},REPORT_TYPE:{},CLR_TYPE:{},COMANY_CODE:{}},l.initCache(y.cached),y.getCache=function(e){return l.getCache(e)},y.getObj=function(e,c){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return r(u(e.data.object,c),6)},function(e){n.error("获取数据%s失败",cacheKey)})},y.queryDetail=g,y.resetForm=h,y.toAuditDetail=s}]),angular.module("myApp").controller("MchntClearAuditDetailCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","dateFilter","$log",function(e,t,a,n,c,i,l){var r=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{},clrFlag:""};r=e.vm=a,r.audit=function(t,a){confirm("确认审核？")&&n.post(config.ctx+"/settlement/unityFunding/mchntClearDetailAudit/audit",c({handleBatchNo:t,auditStatus:a})).then(function(t){var a=t.data;a.success?(alert("操作成功!"),e.cancel()):alert("操作失败!")},function(){alert("操作失败!")})},r.auditFail=function(t,a,c){if(confirm("确认审核？")){r.url=config.ctx+"/settlement/unityFunding/mchntClearDetailAudit/auditFail";var i={};i.handleBatchNo=t,i.clrDate=a,i.clrType=c,n.post(r.url,i,config.jsonHeader).then(function(t){var a=t.data;a.success?(alert("操作成功!"),e.cancel()):alert("操作失败!")},function(){alert("操作失败!")})}},e.cancel=function(){t.dismiss("cancel")}}]);