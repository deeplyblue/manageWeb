angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService",function(e,t,a,i,n,c,o){function r(){var e=document.getElementById("queryForm");A.url=angular.element(e).prop("action"),A.postData=A.queryBean,A.postData.pageSize=A.pagination.pageSize,A.postData.pageNum=A.pagination.pageNum,t.post(A.url,a(A.postData)).then(function(e){var t=e.data;t.success?(A.pagination=t.object,c.clearChecked()):alert(t.msg)})}function d(){A.queryBean={}}function u(e,t){c.updateChecked(e,t),i.debug(t),i.debug(c.getChecked())}function l(){n({modalTitle:"新增",modalBody:"toAdd",url:"add",item:{},cached:{BANK_CARD_TYPE:o.getCache("BANK_CARD_TYPE"),ENABLE_FLAG:o.getCache("ENABLE_FLAG"),REPRT_TYPE:o.getCache("REPRT_TYPE"),QUOTA_FLAG:o.getCache("QUOTA_FLAG"),CARD_TYPE:o.getCache("CARD_TYPE"),CFG_FLAG:o.getCache("CFG_FLAG")}},function(e){A.pagination.list.push(e)})}function g(){if(1!=c.getChecked().length)return void alert("必须勾选一条记录！");var e=A.pagination.list.filter(function(e,t,a){return e.id==c.getChecked()[0]})[0];e.createTime=null,e.lastUpdTime=null,n({modalTitle:"修改",modalBody:"toUpdate",url:"update",item:e,cached:{BANK_CARD_TYPE:o.getCache("BANK_CARD_TYPE"),ENABLE_FLAG:o.getCache("ENABLE_FLAG"),REPRT_TYPE:o.getCache("REPRT_TYPE")}})}function p(){return 1!=c.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:c.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=A.pagination.list.filter(function(e,t,a){return e.id==c.getChecked()[0]})[0];A.pagination.list.splice(A.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),i.debug("error")})}var A=e.vm={};A.pagination={pageSize:10,pageNum:1},A.queryBean={},A.queryDetail=r,A.resetForm=d,A.updateChecked=u,A.addItem=l,A.updateItem=g,A.deleteItem=p,A.cached={BANK_CARD_TYPE:{},ENABLE_FLAG:{},ENABLE_FLAG:{},REPRT_TYPE:{},QUOTA_FLAG:{},CFG_FLAG:{},CARD_TYPE:{}},o.initCache(A.cached)}]);