angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","dateFilter","myConstant",function(e,t,a,i,n,o,c,l,r){function d(){var e=document.getElementById("queryForm");g.url=angular.element(e).prop("action"),g.postData=g.queryBean,g.postData.pageSize=g.pagination.pageSize,g.postData.pageNum=g.pagination.pageNum,t.post(g.url,a(g.postData)).then(function(e){var t=e.data;t.success?(g.pagination=t.object,o.clearChecked()):alert(t.msg)})}function s(){g.queryBean={}}function m(e,t){o.updateChecked(e,t),i.debug(t),i.debug(o.getChecked())}function u(){n({modalTitle:"新增数据词典信息",modalBody:"toAdd",url:"add",item:{},cached:{TRANS_CODE_ALL:c.getCache("TRANS_CODE_ALL")}},function(e){g.pagination.list.push(e)},"BasicDataModalInstanceCtrl","myModalNoFooter.html")}function p(){if(1!=o.getChecked().length)return void alert("必须勾选一条记录！");var e=g.pagination.list.filter(function(e,t,a){return e.id==o.getChecked()[0]})[0];e.createTime=l(e.createTime,"yyyyMMdd"),e.lastUpdTime=l(e.lastUpdTime,"yyyyMMdd"),n({modalTitle:"修改数据词典信息",modalBody:"toUpdate",url:"update",item:e,cached:{TRANS_CODE_ALL:c.getCache("TRANS_CODE_ALL")}},function(){},"","myModalNoFooter.html")}function h(){return 1!=o.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:o.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=g.pagination.list.filter(function(e,t,a){return e.id==o.getChecked()[0]})[0];g.pagination.list.splice(g.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),i.debug("error")})}var g=e.vm={};g.constant=r,g.pagination={pageSize:10,pageNum:1},g.queryBean={},g.queryDetail=d,g.resetForm=s,g.updateChecked=m,g.addItem=u,g.updateItem=p,g.deleteItem=h,g.cached={TRANS_CODE_ALL:{}},c.initCache(g.cached)}]),angular.module("myApp").controller("BasicDataModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","myConstant","$httpParamSerializerJQLike","$log","dateFilter",function(e,t,a,i,n,o,c,l){var r=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};r=e.vm=a,r.constant=n,r.basicData=new Array,r.basicData[0]={itemVal:"",itemDesc:"",itemType:"",spare1:""},r.addDataDictInfo=function(e){r.basicData.push({itemVal:"",itemDesc:"",itemType:"",spare1:""})},r.deleteDataDictInfo=function(e){0==e?alert("第一条信息不能删除!"):r.basicData.remove(e)},Array.prototype.remove=function(e){if(isNaN(e)||e>this.length)return!1;for(var t=0,a=0;t<this.length;t++)this[t]!=this[e]&&(this[a++]=this[t]);this.length-=1},e.save=function(){if(null==r.item.itemName)return void alert("字典项名不能为空");if(null==r.item.colNameCn)return void alert("列中文名不能为空");if(null==r.item.colName)return void alert("列英文名不能为空");for(var t=0;t<r.basicData.length;t++){if(r.basicData[0].itemName=r.item.itemName,r.basicData[0].colNameCn=r.item.colNameCn,r.basicData[0].colName=r.item.colName,null==r.basicData[t].itemVal)return void alert("列值项不能为空");if(null==r.basicData[t].itemDesc)return void alert("描述不能为空")}r.url=config.ctx+"/system/basicData/add";var a={headers:{"Content-Type":"application/json"}};i.post(r.url,r.basicData,a).then(function(t){var a=t.data;a.success?e.cancel():(alert(a.msg),e.cancel())})},e.cancel=function(){t.dismiss("cancel")}}]);