angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,t,n,a,i,r,c,o,u,d,g){function l(){m.cached.RESERVE_LIST=[];for(var e in m.cached.RESERVE_INFO)m.cached.RESERVE_LIST.push({accountNo:e,desc:m.cached.RESERVE_INFO[e].description,bankCode:m.cached.RESERVE_INFO[e].bankCode})}function s(){a.debug("当前日期"+m.queryBean.begin);var e=document.getElementById("queryForm");m.url=angular.element(e).prop("action"),m.postData=m.queryBean,m.queryBean.pageSize=m.pagination.pageSize,m.queryBean.pageNum=m.pagination.pageNum,m.pagination.queryBean=m.queryBean;var n={headers:{"Content-Type":"application/json"}};a.debug("当前日期"+m.queryBean.begin),a.debug("当前日期"+JSON.stringify(m.pagination)),a.debug("当前日期"+JSON.stringify(m.queryBean)),t.post(m.url,m.pagination,n).then(function(e){var t=e.data;t.success?(m.pagination=t.object,r.clearChecked()):alert(t.msg)})}function p(){m.queryBean={}}function h(e,t){r.updateChecked(e,t),a.debug(t),a.debug(r.getChecked())}function f(){i({modalTitle:"新增备付金信息",modalBody:"toAdd",url:"add",item:{},cached:{}},function(e){m.pagination.list.push(e)})}function E(){if(1!=r.getChecked().length)return void alert("必须勾选一条记录！");var e=m.pagination.list.filter(function(e,t,n){if(e.id==r.getChecked()[0])return!0})[0];i({modalTitle:"修改备付金信息",modalBody:"toUpdate",url:"update",item:e,cached:{MERCHANT_CODE:c.getCache("MERCHANT_CODE"),ALL_CITY:m.cached.ALL_CITY}},function(e){a.debug(e)})}function y(){return 1!=r.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",n({id:r.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var n=m.pagination.list.filter(function(e,t,n){return e.id==r.getChecked()[0]})[0];m.pagination.list.splice(m.pagination.list.indexOf(n),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),a.debug("error")})}var m=e.vm={};m.constant=g,m.pagination={pageSize:10,pageNum:1},m.cached={RESERVE_INFO:{},RESERVE_LIST:{}},function(){m.queryBean={};var e=new Date;e.setDate(e.getDate()-1);var n=new Date(e.getFullYear(),e.getMonth(),e.getDate());m.queryBean.begin=n,m.queryBean.end=n,a.debug("当前日期"+m.queryBean.beginDate),t.post(config.ctx+"/reserve/info/init/reserve",{},config.jsonHeader).then(function(e){e.data.success?(m.cached.RESERVE_INFO=e.data.object,l()):a.error("获取数据%s失败",e.data.msg)},function(e){a.error("获取数据%s失败",cacheKey)})}(),m.getCache=function(e){return c.getCache(e)},m.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",n({cacheKey:e})).then(function(e){return o(u(e.data.object,i),6)},function(e){a.error("获取数据%s失败",cacheKey)})},m.queryDetail=s,m.resetForm=p,m.updateChecked=h,m.addItem=f,m.updateItem=E,m.deleteItem=y}]);