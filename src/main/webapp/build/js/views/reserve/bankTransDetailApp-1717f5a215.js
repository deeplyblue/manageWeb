angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,t,a,n,c,i,o,r,l,u,d){function s(){b.cached.RESERVE_LIST=[];for(var e in b.cached.RESERVE_INFO)b.cached.RESERVE_LIST.push({accountNo:e,desc:b.cached.RESERVE_INFO[e].description,bankCode:b.cached.RESERVE_INFO[e].bankCode})}function g(){n.debug("当前日期"+b.queryBean.begin);var e=document.getElementById("queryForm");b.url=angular.element(e).prop("action"),b.queryBean.pageSize=b.pagination.pageSize,b.queryBean.pageNum=b.pagination.pageNum,b.pagination.queryBean=b.queryBean;var a={headers:{"Content-Type":"application/json"}};n.debug("当前日期"+b.queryBean.begin),n.debug("当前日期"+JSON.stringify(b.pagination)),n.debug("当前日期"+JSON.stringify(b.queryBean)),t.post(b.url,b.pagination,a).then(function(e){var t=e.data;t.success?(b.pagination=t.object,i.clearChecked()):alert(t.msg)})}function h(){b.queryBean={}}function m(e,t){i.updateChecked(e,t),n.debug(t),n.debug(i.getChecked())}function p(){c({modalTitle:"新增备付金信息",modalBody:"toAdd",url:"add",item:{},cached:{}},function(e){b.pagination.list.push(e)})}function f(e){var a={};t.post(config.ctx+"/bank/trans/detail/queryPeriodCheck",e,config.jsonHeader).then(function(t){var i=t.data;i.success?a=i.object.list:alert(i.msg),c({modalTitle:"核对业务/银行实际交易流水",modalBody:"toCheck",url:"check",item:e,cached:{CHECK_LIST:a,COMANY_CODE:b.cached.COMANY_CODE}},function(e){n.debug(e)},"checkTransDetailModalInstanceCtrl","myModalNoSave.html")})}function C(){if(1!=i.getCheckedNew(b.pagination.list).length)return void alert("必须勾选一条记录！");var e=i.getCheckedNew(b.pagination.list)[0];c({modalTitle:"修改银行实际交易流水",modalBody:"toUpdate",url:"update",item:e,cached:{TRANS_TYPE:b.tempParams.transType}},function(e){n.debug(e)},"updateTransDetailModalInstanceCtrl")}function y(){return 1!=i.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:i.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=b.pagination.list.filter(function(e,t,a){return e.id==i.getChecked()[0]})[0];b.pagination.list.splice(b.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var b=e.vm={};b.constant=d,b.pagination={pageSize:10,pageNum:1},b.cached={RESERVE_LIST:{},RESERVE_INFO:{},COMANY_CODE:{}},b.tempParams={transType:{"001":"支付结算","002":"退款结算","003":"利息","004":"预付卡","005":"自有资金","006":"手续费","007":"风险保证金","008":"商户结算","009":"头寸调拨","010":"管理费"}},function(){b.queryBean={},t.post(config.ctx+"/reserve/info/init/reserve",{},config.jsonHeader).then(function(e){e.data.success?(b.cached.RESERVE_INFO=e.data.object,s()):n.error("获取数据%s失败",e.data.msg)},function(e){n.error("获取数据%s失败",cacheKey)}),o.initCache("COMANY_CODE",function(e,t){n.debug("COMANY_CODE",t),b.cached.COMANY_CODE=t})}(),function(){b.queryBean={};var e=new Date;e.setDate(e.getDate()-1);var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());b.queryBean.begin=t,b.queryBean.end=t}(),b.getCache=function(e){return o.getCache(e)},b.getObj=function(e,c){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return r(l(e.data.object,c),6)},function(e){n.error("获取数据%s失败",cacheKey)})},b.queryDetail=g,b.resetForm=h,b.updateChecked=m,b.addItem=p,b.updateItem=C,b.deleteItem=y,b.checkBusiness=f}]),angular.module("myApp").controller("updateTransDetailModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","FileUploader","dateFilter","$log","myConstant",function(e,t,a,n,c,i,o,r,l){var u=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};u=e.vm=a,u.constant=l,e.cancel=function(){t.dismiss("cancel")},e.save=function(){var e=angular.copy(u.item);r.debug("进入特殊修改类:{}",e),n.post(u.url,e,config.jsonHeader).then(function(e){e.data.success?(alert("操作成功"),t.close(u.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})}}]),angular.module("myApp").controller("checkTransDetailModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","FileUploader","dateFilter","$log","CheckboxService","myConstant","DateCalculateService",function(e,t,a,n,c,i,o,r,l,u,d){function s(){r.debug("查询核对业务数据:{}",p.queryBean),n.post(config.ctx+"/bank/trans/detail/queryPeriodCheck",p.queryBean,config.jsonHeader).then(function(e){var t=e.data;t.success?p.cached.CHECK_LIST=t.object.list:alert(t.msg)})}function g(){r.debug("查询核对业务数据:{}",p.queryBean);var e=angular.copy(p.queryBean);delete e.accountNo,n.post(config.ctx+"/bank/trans/detail/queryPeriodCheck",e,config.jsonHeader).then(function(e){var t=e.data;t.success?p.cached.CHECK_LIST=t.object.list:alert(t.msg)})}function h(e){confirm("你确定要清除核对！")&&n.post(config.ctx+"/bank/trans/detail/clearPeriodCheck",e,config.jsonHeader).then(function(e){e.data.success?(alert("操作成功"),t.close()):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})}function m(){if(l.getCheckedNew(p.cached.CHECK_LIST).length<1)return void alert("必须勾选一条记录！");var e=l.getCheckedNew(p.cached.CHECK_LIST);for(var a in e)e[a].bankTransDate=p.item.settleDate,e[a].bankTransNo=p.item.id;n.post(config.ctx+"/bank/trans/detail/updatePeriodCheck",e,config.jsonHeader).then(function(e){e.data.success?(alert("操作成功"),t.close()):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})}var p=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};p=e.vm=a,p.constant=u,p.queryBean={},p.queryDetail=s,p.checkTrans=m,p.checkAccount=g,p.clearCheck=h,p.queryBean.accountNo=p.item.accountNo,p.queryBean.end=new Date(p.item.settleDate),p.queryBean.begin=new Date(p.item.settleDate),r.debug("vm信息:{}",p),e.cancel=function(){t.dismiss("cancel")}}]);