angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,t,a,n,i,c,r,o,l,d,u){function s(){var e=document.getElementById("queryForm");C.url=angular.element(e).prop("action");var a=angular.copy(C.queryBean);a.pageSize=C.pagination.pageSize,a.pageNum=C.pagination.pageNum,C.pagination.queryBean=a,t.post(C.url,C.pagination,config.jsonHeader).then(function(e){var t=e.data;t.success?(C.pagination=t.object,C.sumObject=t.sumObject,c.clearChecked()):alert(t.msg)})}function p(){C.queryBean={}}function g(e,t){c.updateChecked(e,t),n.debug(t),n.debug(c.getChecked())}function m(){i({modalTitle:"新增预付卡信息",modalBody:"toAdd",url:"add",item:{},cached:{}},function(e){C.pagination.list.push(e)},"prepaidCardAddModalInstanceCtrl")}function f(){if(1!=c.getChecked().length)return void alert("必须勾选一条记录！");var e=C.pagination.list.filter(function(e,t,a){if(e.id==c.getChecked()[0])return!0})[0];e.createTime=null,e.lastUpdTime=null,i({modalTitle:"修改预付卡信息",modalBody:"toUpdate",url:"update",item:e,cached:{}},function(e){n.debug(e)},"prepaidCardAddModalInstanceCtrl")}function h(){return 1!=c.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:c.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=C.pagination.list.filter(function(e,t,a){return e.id==c.getChecked()[0]})[0];C.pagination.list.splice(C.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var C=e.vm={};C.constant=u,C.pagination={pageSize:10,pageNum:1},C.queryBean={},C.cached={},function(){for(var e in C.cached)r.initCache(e,function(e,t){n.debug(e,t),C.cached[e]=t})}(),C.getCache=function(e){return r.getCache(e)},C.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return o(l(e.data.object,i),6)},function(e){n.error("获取数据%s失败",cacheKey)})},C.queryDetail=s,C.resetForm=p,C.updateChecked=g,C.addItem=m,C.updateItem=f,C.deleteItem=h}]),angular.module("myApp").controller("prepaidCardAddModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","$log","myConstant",function(e,t,a,n,i,c,r){var o=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};o=e.vm=a,o.constant=r,e.save=function(){n.post(o.url,o.item,config.jsonHeader).then(function(e){e.data.success?(alert("操作成功"),t.close(o.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}}]);