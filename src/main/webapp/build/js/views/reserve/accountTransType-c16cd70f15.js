angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,t,a,n,c,i,o,r,u,d,l){function g(){S.cached.RESERVE_LIST=[];for(var e in S.cached.RESERVE_INFO)S.cached.RESERVE_LIST.push({accountNo:e,desc:S.cached.RESERVE_INFO[e].description})}function s(){var e=document.getElementById("queryForm");S.url=angular.element(e).prop("action");var n=angular.copy(S.queryBean);n.pageSize=S.pagination.pageSize,n.pageNum=S.pagination.pageNum,t.post(S.url,a(n)).then(function(e){var t=e.data;t.success?(S.pagination=t.object,i.clearChecked()):alert(t.msg)})}function p(){S.queryBean={}}function h(e,t){i.updateChecked(e,t),n.debug(t),n.debug(i.getChecked())}function f(){c({modalTitle:"新增备付金交易类型",modalBody:"toAdd",url:"add",item:{},cached:{RESERVE_LIST:S.cached.RESERVE_LIST}},function(e){S.pagination.list.push(e)})}function E(){if(1!=i.getCheckedNew(S.pagination.list).length)return void alert("必须勾选一条记录！");var e=i.getCheckedNew(S.pagination.list)[0];c({modalTitle:"修改备付金交易类型",modalBody:"toUpdate",url:"update",item:e,cached:{}},function(e){n.debug(e)})}function m(){if(1!=i.getCheckedNew(S.pagination.list).length)return void alert("必须勾选一条记录！");var e=i.getCheckedNew(S.pagination.list)[0];t.post("delete",a(e)).then(function(t){var a=t.data;a.success?(S.pagination.list.splice(S.pagination.list.indexOf(e),1),alert("操作成功")):alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var S=e.vm={};S.constant=l,S.pagination={pageSize:10,pageNum:1},S.queryBean={},S.cached={RESERVE_LIST:{},RESERVE_INFO:{}},function(){S.queryBean={},t.post(config.ctx+"/reserve/info/init/reserve",{},config.jsonHeader).then(function(e){e.data.success?(S.cached.RESERVE_INFO=e.data.object,g()):n.error("获取数据%s失败",e.data.msg)},function(e){n.error("获取数据%s失败",cacheKey)})}(),S.getCache=function(e){return o.getCache(e)},S.getObj=function(e,c){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return r(u(e.data.object,c),6)},function(e){n.error("获取数据%s失败",cacheKey)})},S.queryDetail=s,S.resetForm=p,S.updateChecked=h,S.addItem=f,S.updateItem=E,S.deleteItem=m}]);