angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,t,a,n,i,r,o,c,u,d,g){function l(e){location.href=config.ctx+"/report/file/downloadReportFile?groupName="+e.groupName+"&dfsFilePath="+e.dfsFilePath+"&orgFileName="+e.orgFileName}function p(e){var a={headers:{"Content-Type":"application/json"}};t.post(config.ctx+"/report/file/reset",e,a).then(function(t){var a=t.data;a.success?b.pagination.list.splice(b.pagination.list.indexOf(e),1):alert(a.msg)})}function s(){n.debug("当前日期"+b.queryBean.beginDate);var e=document.getElementById("queryForm");b.url=angular.element(e).prop("action"),b.postData=b.queryBean,b.queryBean.pageSize=b.pagination.pageSize,b.queryBean.pageNum=b.pagination.pageNum,b.pagination.queryBean=b.queryBean;var a={headers:{"Content-Type":"application/json"}};n.debug("当前日期"+b.queryBean.beginDate),n.debug("当前日期"+JSON.stringify(b.pagination)),n.debug("当前日期"+JSON.stringify(b.queryBean)),t.post(b.url,b.pagination,a).then(function(e){var t=e.data;t.success?(b.pagination=t.object,r.clearChecked()):alert(t.msg)})}function f(){b.queryBean={}}function h(e,t){r.updateChecked(e,t),n.debug(t),n.debug(r.getChecked())}function m(){i({modalTitle:"新增备付金信息",modalBody:"toAdd",url:"add",item:{},cached:{}},function(e){b.pagination.list.push(e)})}function y(){if(1!=r.getChecked().length)return void alert("必须勾选一条记录！");var e=b.pagination.list.filter(function(e,t,a){if(e.id==r.getChecked()[0])return!0})[0];i({modalTitle:"修改备付金信息",modalBody:"toUpdate",url:"update",item:e,cached:{MERCHANT_CODE:o.getCache("MERCHANT_CODE"),ALL_CITY:b.cached.ALL_CITY}},function(e){n.debug(e)})}function C(){return 1!=r.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:r.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=b.pagination.list.filter(function(e,t,a){return e.id==r.getChecked()[0]})[0];b.pagination.list.splice(b.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var b=e.vm={};b.constant=g,b.pagination={pageSize:10,pageNum:1},b.cached={},function(){b.queryBean={};var e=new Date;e.setDate(e.getDate()-1);var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());b.queryBean.beginDate=t,b.queryBean.endDate=t,n.debug("当前日期"+b.queryBean.beginDate);for(var a in b.cached)o.initCache(a,function(e,t){n.debug(e,t),b.cached[e]=t})}(),b.getCache=function(e){return o.getCache(e)},b.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return c(u(e.data.object,i),6)},function(e){n.error("获取数据%s失败",cacheKey)})},b.queryDetail=s,b.resetForm=f,b.updateChecked=h,b.addItem=m,b.updateItem=y,b.deleteItem=C,b.downFile=l,b.resetGenerateReport=p}]);