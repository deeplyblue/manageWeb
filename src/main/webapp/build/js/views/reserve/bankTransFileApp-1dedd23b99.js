angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,a,t,n,o,c,l,i,r,u,d){function f(){E.cached.RESERVE_LIST=[];for(var e in E.cached.RESERVE_INFO)E.cached.RESERVE_LIST.push({accountNo:e,bankCode:E.cached.RESERVE_INFO[e].bankCode});E.queryBean.accountNo=E.cached.RESERVE_LIST[0].accountNo}function m(){var e=document.getElementById("queryForm");E.url=angular.element(e).prop("action");var t=angular.copy(E.queryBean);t.pageNum=E.pagination.pageNum,t.pageSize=E.pagination.pageSize,a.post(E.url,t,config.jsonHeader).then(function(e){var a=e.data;a.success?(E.pagination=a.object,c.clearChecked()):alert(a.msg)})}function s(){E.queryBean={}}function p(){o({modalTitle:"上传文件",modalBody:"toUpload",url:"upload",item:{},cached:{RESERVE_LIST:E.cached.RESERVE_LIST,RESERVE_INFO:E.cached.RESERVE_INFO}},function(e){},"uploadReserveModalInstanceCtrl","myModalNoSave.html")}var E=e.vm={};E.constant=d,E.pagination={pageSize:10,pageNum:1},E.cached={RESERVE_LIST:{},RESERVE_INFO:{}},function(){E.queryBean={},a.post(config.ctx+"/reserve/info/init/reserve",{},config.jsonHeader).then(function(e){e.data.success?(E.cached.RESERVE_INFO=e.data.object,f()):n.error("获取数据%s失败",e.data.msg)},function(e){n.error("获取数据%s失败",cacheKey)})}(),E.getCache=function(e){return l.getCache(e)},E.getObj=function(e,o){return a.post(config.ctx+"/base/cache/getAll",t({cacheKey:e})).then(function(e){return i(r(e.data.object,o),6)},function(e){n.error("获取数据%s失败",cacheKey)})},E.queryDetail=m,E.resetForm=s,E.upload=p}]),angular.module("myApp").controller("uploadReserveModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","FileUploader","$log",function(e,a,t,n,o,c,l){function i(){if(!r.item.accountNo)return alert("请先选择备付金银行"),!1;var a=r.cached.RESERVE_INFO[r.item.accountNo];return r.file1.accountNo=a.accountNo,r.file1.bankCode=a.bankCode,r.file1.accountName=a.accountName,r.file1.className=a.className,r.file1.originFileName?void n.post(config.ctx+"/bank/trans/file/upload",o(r.file1)).then(function(a){var t=a.data;t.success?(alert("提交成功"),e.cancel()):alert(t.msg)}):(alert("请先上传文件"),!1)}var r=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};r=e.vm=t,r.file1={},r.fileUploader=new c({url:config.ctx+"/system/fileUploader/upload",formData:[{busiType:"BF",remark:"备付金文件上传"}],filters:[{name:"limitItem",fn:function(e){return!(r.fileUploader.queue.length>=1)||(alert("请先取消原先文件,再选择新文件!"),!1)}}]}),r.fileUploader.onSuccessItem=function(e,a,t,n){r.file1={originFileName:e.file.name,dfsFilePath:a.object.dfsFullFilename,groupName:a.object.dfsGroupName,localFilePath:a.object.localFilename}},r.fileUploader.onCancelItem=function(e,a,t,n){r.file1={}},r.uploadBean={},r.uploadFile=i,e.save=function(){},e.cancel=function(){a.dismiss("cancel")}}]);