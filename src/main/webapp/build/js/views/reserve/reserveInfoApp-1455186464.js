angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant",function(e,t,n,a,c,i,r,o,d,u,l){function g(){C.cached.RESERVE_LIST=[];for(var e in C.cached.RESERVE_INFO)C.cached.RESERVE_LIST.push({accountNo:e,desc:C.cached.RESERVE_INFO[e].description})}function h(){var e=document.getElementById("queryForm");C.url=angular.element(e).prop("action");var a=angular.copy(C.queryBean);a.pageSize=C.pagination.pageSize,a.pageNum=C.pagination.pageNum,a.beginTime=u(a.beginTime,"yyyy-MM-dd"),a.endTime=u(a.endTime,"yyyy-MM-dd"),t.post(C.url,n(a)).then(function(e){var t=e.data;t.success?(C.pagination=t.object,i.clearChecked()):alert(t.msg)})}function s(){C.queryBean={}}function p(e,t){i.updateChecked(e,t),a.debug(t),a.debug(i.getChecked())}function f(){c({modalTitle:"新增备付金信息",modalBody:"toAdd",url:"add",item:{},cached:{MERCHANT_CODE:r.getCache("MERCHANT_CODE"),ALL_CITY:C.cached.ALL_CITY}},function(e){C.pagination.list.push(e)})}function E(){if(1!=i.getChecked().length)return void alert("必须勾选一条记录！");var e=C.pagination.list.filter(function(e,t,n){if(e.id==i.getChecked()[0])return!0})[0];c({modalTitle:"修改备付金信息",modalBody:"toUpdate",url:"update",item:e,cached:{MERCHANT_CODE:r.getCache("MERCHANT_CODE"),ALL_CITY:C.cached.ALL_CITY}},function(e){a.debug(e)})}function m(){return 1!=i.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",n({id:i.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var n=C.pagination.list.filter(function(e,t,n){return e.id==i.getChecked()[0]})[0];C.pagination.list.splice(C.pagination.list.indexOf(n),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),a.debug("error")})}var C=e.vm={};C.constant=l,C.pagination={pageSize:10,pageNum:1},C.queryBean={},C.cached={RESERVE_LIST:{},RESERVE_INFO:{}},function(){C.queryBean={},t.post(config.ctx+"/reserve/info/init/reserve",{},config.jsonHeader).then(function(e){e.data.success?(C.cached.RESERVE_INFO=e.data.object,g()):a.error("获取数据%s失败",e.data.msg)},function(e){a.error("获取数据%s失败",cacheKey)})}(),C.getCache=function(e){return r.getCache(e)},C.getObj=function(e,c){return t.post(config.ctx+"/base/cache/getAll",n({cacheKey:e})).then(function(e){return o(d(e.data.object,c),6)},function(e){a.error("获取数据%s失败",cacheKey)})},C.queryDetail=h,C.resetForm=s,C.updateChecked=p,C.addItem=f,C.updateItem=E,C.deleteItem=m}]);