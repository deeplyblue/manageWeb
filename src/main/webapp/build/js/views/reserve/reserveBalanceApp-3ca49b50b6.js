angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant","DateCalculateService",function(e,t,a,n,i,r,c,o,u,d,l,s){function g(){v.cached.RESERVE_LIST=[];for(var e in v.cached.RESERVE_INFO)v.cached.RESERVE_LIST.push({accountNo:e,desc:v.cached.RESERVE_INFO[e].description,bankCode:v.cached.RESERVE_INFO[e].bankCode})}function p(){n.debug("当前日期"+v.queryBean.begin);var e=document.getElementById("queryForm");v.url=angular.element(e).prop("action"),v.queryBean.pageSize=v.pagination.pageSize,v.queryBean.pageNum=v.pagination.pageNum,v.pagination.queryBean=v.queryBean;var a={headers:{"Content-Type":"application/json"}};n.debug("当前日期"+v.queryBean.begin),n.debug("当前日期"+JSON.stringify(v.pagination)),n.debug("当前日期"+JSON.stringify(v.queryBean)),t.post(v.url,v.pagination,a).then(function(e){var t=e.data;t.success?(v.pagination=t.object,r.clearChecked()):alert(t.msg)})}function f(){v.queryBean={},v.queryBean.begin=s.dayBefore(1),v.queryBean.end=s.dayBefore(1)}function m(e,t){r.updateChecked(e,t),n.debug(t),n.debug(r.getChecked())}function h(){i({modalTitle:"新增备付金信息",modalBody:"toAdd",url:"add",item:{},cached:{}},function(e){v.pagination.list.push(e)})}function y(){if(1!=r.getCheckedNew(v.pagination.list).length)return void alert("必须勾选一条记录！");var e=r.getCheckedNew(v.pagination.list)[0];i({modalTitle:"修改备付金余额",modalBody:"toUpdate",url:"update",item:e,cached:{TRANS_TYPE:v.tempParams.transType}},function(e){n.debug(e)},"updateReserveBalanceModalInstanceCtrl")}function E(){return 1!=r.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:r.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=v.pagination.list.filter(function(e,t,a){return e.id==r.getChecked()[0]})[0];v.pagination.list.splice(v.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var v=e.vm={};v.constant=l,v.pagination={pageSize:10,pageNum:1},v.cached={RESERVE_LIST:{},RESERVE_INFO:{}},v.tempParams={transType:{"001":"支付结算","002":"退款结算","003":"利息","004":"预付卡","005":"自有资金","006":"手续费","007":"风险保证金","008":"商户结算","009":"头寸调拨","010":"管理费"}},function(){v.queryBean={},t.post(config.ctx+"/reserve/info/init/reserve",{},config.jsonHeader).then(function(e){e.data.success?(v.cached.RESERVE_INFO=e.data.object,g()):n.error("获取数据%s失败",e.data.msg)},function(e){n.error("获取数据%s失败",cacheKey)})}(),function(){v.queryBean={},v.queryBean.begin=s.dayBefore(1),v.queryBean.end=s.dayBefore(1)}(),v.getCache=function(e){return c.getCache(e)},v.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return o(u(e.data.object,i),6)},function(e){n.error("获取数据%s失败",cacheKey)})},v.queryDetail=p,v.resetForm=f,v.updateChecked=m,v.addItem=h,v.updateItem=y,v.deleteItem=E}]),angular.module("myApp").controller("updateReserveBalanceModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","FileUploader","dateFilter","$log","myConstant",function(e,t,a,n,i,r,c,o,u){var d=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};d=e.vm=a,d.constant=u,e.save=function(){var e=angular.copy(d.item);o.debug("进入特殊修改类:{}",e),n.post(d.url,e,config.jsonHeader).then(function(e){e.data.success?(alert("操作成功"),t.close(d.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}}]);