angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","myConstant","dateFilter",function(e,t,a,n,o,r,i,c,u){function l(){var e=document.getElementById("queryForm");h.url=angular.element(e).prop("action"),h.postData=h.queryBean,h.postData.pageSize=h.pagination.pageSize,h.postData.pageNum=h.pagination.pageNum,t.post(h.url,a(h.postData)).then(function(e){var t=e.data;t.success?(h.pagination=t.object,r.clearChecked()):alert(t.msg)})}function d(){h.queryBean={}}function s(e,t){r.updateChecked(e,t),n.debug(t),n.debug(r.getChecked())}function g(){o({modalTitle:"新增机构信息",modalBody:"toAdd",url:"add",item:{},cached:{ORG_TYPR:i.getCache("ORG_TYPR"),ALL_CITY:h.cached.ALL_CITY,PAY_BANK_CODE:i.getCache("PAY_BANK_CODE"),ORG_CHANNEL_TYPE:i.getCache("ORG_CHANNEL_TYPE")}},function(e){l()},"updateOrganizeInstanceCtrl","myModalNoFooter.html")}function p(e,n){var o=angular.copy(e);o.createTime=null,o.lastUpdTime=null,o.orgConnDate=null,o.orgStatus=e.orgStatus,t.post(config.ctx+"/institution/payment/update",a(o)).then(function(t){t.data.success?(e.orgStatus=o.orgStatus,alert("操作成功")):alert(t.data.msg)},function(e){alert("操作失败"),alert(e.status)})}function C(){if(1!=r.getChecked().length)return void alert("必须勾选一条记录！");var e,t,a=h.pagination.list.filter(function(a,n,o){if(a.orgCode==r.getChecked()[0])return console.debug(a.orgArea),e=h.cached.ALL_CITY.filter(function(e){if(a.orgArea.substring(0,2)&&e.areaCode==a.orgArea.substring(0,2))return!0})[0],t=e.citys.filter(function(e){if(a.orgArea.substring(2,4)&&e.cityCode==a.orgArea.substring(2,4))return!0})[0],!0})[0];o({modalTitle:"修改机构信息",modalBody:"toUpdate",url:"update",item:a,pro:e,city:t,cached:{ALL_CITY:h.cached.ALL_CITY,ORG_TYPR:i.getCache("ORG_TYPR"),PAY_BANK_CODE:i.getCache("PAY_BANK_CODE"),ORG_CHANNEL_TYPE:i.getCache("ORG_CHANNEL_TYPE")}},function(e){n.debug(e)},"updateOrganizeInstanceCtrl","myModalNoFooter.html")}function m(){return 1!=r.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({orgCode:r.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=h.pagination.list.filter(function(e,t,a){return e.orgCode==r.getChecked()[0]})[0];h.pagination.list.splice(h.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var h=e.vm={};h.constant=c,h.pagination={pageSize:10,pageNum:1},h.queryBean={},h.queryDetail=l,h.resetForm=d,h.updateChecked=s,h.addItem=g,h.updateItem=C,h.deleteItem=m,h.updateItemEnableFlag=p,h.cached={ORG_CATEGORY:{},ORG_TYPR:{},ORG_STATUS:{},COMANY_CODE:{},PAY_BANK_CODE:{},ORG_CHANNEL_TYPE:{}},function(){i.getObj("ALL_CITY",function(e,t){n.debug(t),h.cached.ALL_CITY=t}),i.initCaches(h.cached)}(),h.getCache=function(e){return i.getCache(e)}}]),angular.module("myApp").controller("updateOrganizeInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","$log","dateFilter","myConstant",function(e,t,a,n,o,r,i,c){var u=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};u=e.vm=a,u.constant=c,e.save=function(){u.postData=angular.copy(u.item),u.postData.orgConnDate=i(u.postData.orgConnDate,"yyyyMMdd"),u.postData.createTime=null,u.postData.lastUpdTime=null,r.debug(u.postData),n.post(u.url,o(u.postData)).then(function(e){e.data.success?(alert("操作成功"),t.close(u.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}}]);