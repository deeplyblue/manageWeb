angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService",function(e,t,a,n,i,c,o){function r(){var e=document.getElementById("queryForm");C.url=angular.element(e).prop("action"),C.postData=C.queryBean,C.postData.pageSize=C.pagination.pageSize,C.postData.pageNum=C.pagination.pageNum,t.post(C.url,a(C.postData)).then(function(e){var t=e.data;t.success?(C.pagination=t.object,c.clearChecked()):alert(t.msg)})}function d(){C.queryBean={}}function u(e,t){c.updateChecked(e,t),n.debug(t),n.debug(c.getChecked())}function l(){i({modalTitle:"新增业务机构信息 ",modalBody:"toAdd",url:"add",item:{},cached:{QUOTA_FLAG:o.getCache("QUOTA_FLAG"),CFG_FLAG:o.getCache("CFG_FLAG"),CONN_CHANNEL:o.getCache("CONN_CHANNEL")}},function(e){C.pagination.list.push(e)})}function g(){if(1!=c.getChecked().length)return void alert("必须勾选一条记录！");var e=C.pagination.list.filter(function(e,t,a){return e.id==c.getChecked()[0]})[0];e.createTime=null,e.lastUpdTime=null,i({modalTitle:"修改业务机构信息",modalBody:"toUpdate",url:"update",item:e,cached:{QUOTA_FLAG:o.getCache("QUOTA_FLAG"),CFG_FLAG:o.getCache("CFG_FLAG"),CONN_CHANNEL:o.getCache("CONN_CHANNEL")}})}function p(){return 1!=c.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:c.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=C.pagination.list.filter(function(e,t,a){return e.id==c.getChecked()[0]})[0];C.pagination.list.splice(C.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var C=e.vm={};C.pagination={pageSize:10,pageNum:1},C.queryBean={},C.queryDetail=r,C.resetForm=d,C.updateChecked=u,C.addItem=l,C.updateItem=g,C.deleteItem=p,C.cached={QUOTA_FLAG:{},CFG_FLAG:{},CONN_CHANNEL:{}},function(){o.initCache(C.cached),o.getObj("ALL_CITY",function(e,t){n.debug(t),C.cached.ALL_CITY=t})}()}]);