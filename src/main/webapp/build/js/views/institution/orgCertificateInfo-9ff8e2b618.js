angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","myConstant","dateFilter",function(e,t,a,i,n,l,o,r,c){function d(){var e=document.getElementById("queryForm");g.url=angular.element(e).prop("action"),g.postData=g.queryBean,g.postData.pageSize=g.pagination.pageSize,g.postData.pageNum=g.pagination.pageNum,t.post(g.url,a(g.postData)).then(function(e){var t=e.data;t.success?(g.pagination=t.object,l.clearChecked()):alert(t.msg)})}function u(){g.queryBean={}}function s(e,t){l.updateChecked(e,t),i.debug(t),i.debug(l.getChecked())}function f(){n({modalTitle:"新增机构证书",modalBody:"toAdd",url:"add",item:{},cached:{COMANY_CODE:o.getCache("COMANY_CODE")}},function(e){d()},"addOrgCertificateInfo","myModalNoFooter.html")}function m(e,i){if(confirm("是否确认此操作?")){var n=angular.copy(e);n.effectData=c(n.effectData,"yyyy-MM-dd"),n.expiryData=c(n.expiryData,"yyyy-MM-dd"),n.lastUpdTime=c(n.lastUpdTime,"yyyy-MM-dd"),n.createTime=c(n.createTime,"yyyy-MM-dd"),n.operateStatus=i,"02"==n.operateStatus&&(n.status="0"),"04"==i&&(n.status="1",n.operateStatus="00"),"05"==n.operateStatus&&(n.status="2"),t.post(config.ctx+"/institution/orgCertificate/update",a(n)).then(function(e){e.data.success?(alert("操作成功"),d()):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})}}function p(){return 1!=l.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({id:l.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=g.pagination.list.filter(function(e,t,a){return e.userId==l.getChecked()[0]})[0];g.pagination.list.splice(g.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),i.debug("error")})}var g=e.vm={};g.constant=r,g.pagination={pageSize:10,pageNum:1},g.queryBean={},g.queryDetail=d,g.resetForm=u,g.updateChecked=s,g.addItem=f,g.updateItemEnableFlag=m,g.deleteItem=p,g.cached={TRANS_CODE_ALL:{},COMANY_CODE:{}},o.initCache(g.cached)}]),angular.module("myApp").controller("addOrgCertificateInfo",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","FileUploader","$log","$timeout","dateFilter","myConstant",function(e,t,a,i,n,l,o,r,c,d){var u=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};u=e.vm=a,u.constant=d,u.constant=d,u.constant=d,u.fileItems=[{field:"dfsFullFilename"}],u.fileUploader=new l({url:config.ctx+"/system/fileUploader/upload",formData:[{busiType:"OC",remark:"机构证书"}],removeAfterUpload:!1}),u.fileUploader.onAfterAddingFile=function(e,t){u.fileUploader.queue.forEach(function(t){t.field==e.field&&t!=e&&u.fileUploader.removeFromQueue(t)})},u.fileUploader.onSuccessItem=function(e,t,a,i){e.originFileName=e.file.name,e.dfsFullFilename=t.object.dfsFullFilename,e.dfsGroupName=t.object.dfsGroupName},e.save=function(){var e=angular.copy(u.item);return e.effectData=c(e.effectData,"yyyy-MM-dd"),e.expiryData=c(e.expiryData,"yyyy-MM-dd"),u.fileUploader.queue.forEach(function(t){e.localFilename=t.originFileName.substring(0,t.originFileName.lastIndexOf(".")),e.certificateType=t.originFileName.substring(t.originFileName.lastIndexOf(".")+1),t.isSuccess&&(e[t.field]=t.dfsFullFilename)}),null==e.localFilename?(alert("请上传机构证书！"),!1):void i.post(u.url,n(e)).then(function(e){e.data.success?(alert("操作成功"),t.close(u.item)):alert(e.data.msg)},function(e){alert("操作失败"),alert(e.status)})},e.cancel=function(){t.dismiss("cancel")}}]);