angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","myConstant",function(e,t,a,n,i,r,c,o){function u(){var e=document.getElementById("queryForm");m.url=angular.element(e).prop("action"),m.postData=m.queryBean,m.postData.pageSize=m.pagination.pageSize,m.postData.pageNum=m.pagination.pageNum,t.post(m.url,a(m.postData)).then(function(e){var t=e.data;t.success?(m.pagination=t.object,r.clearChecked()):alert(t.msg)})}function l(){m.queryBean={}}function d(e,t){r.updateChecked(e,t),n.debug(t),n.debug(r.getChecked())}function s(){i({modalTitle:"新增对账配置",modalBody:"toAdd",url:"add",item:{},cached:{COMANY_CODE:c.getCache("COMANY_CODE")}},function(e){m.pagination.list.push(e)})}function p(){return 1!=r.getChecked().length?void alert("必须勾选一条记录！"):void i({modalTitle:"修改对账配置",modalBody:"toUpdate",url:"update",item:m.pagination.list.filter(function(e,t,a){return e.createdTime=null,e.updatedTime=null,e.id==r.getChecked()[0]})[0],cached:{COMANY_CODE:m.cached.COMANY_CODE}})}function g(){return 1!=r.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({userId:r.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=m.pagination.list.filter(function(e,t,a){return e.userId==r.getChecked()[0]})[0];m.pagination.list.splice(m.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}function h(e){t.post("open",a({id:e})).then(function(e){var t=e.data;t.success?(m.queryDetail(),alert("操作成功")):alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}function f(e){t.post("close",a({id:e})).then(function(e){var t=e.data;t.success?(m.queryDetail(),alert("操作成功")):alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var m=e.vm={};m.constant=o,m.pagination={pageSize:10,pageNum:1},m.queryBean={},m.queryDetail=u,m.resetForm=l,m.updateChecked=d,m.addItem=s,m.updateItem=p,m.deleteItem=g,m.openItem=h,m.closeItem=f,m.cached={COMANY_CODE:{}},c.initCache(m.cached),m.getCache=function(e){return c.getCache(e)},m.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return limitToFilter(filterFilter(e.data.object,i),6)},function(e){n.error("获取数据%s失败",cacheKey)})}}]);