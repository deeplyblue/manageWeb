angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","dateFilter","myConstant","DateCalculateService",function(e,t,a,n,r,o,c,i,d,y){function l(){var e=document.getElementById("queryForm");g.url=angular.element(e).prop("action"),g.postData=g.queryBean,g.postData.pageSize=g.pagination.pageSize,g.postData.pageNum=g.pagination.pageNum,g.postData.sDateStart=i(g.queryBean.oDateStart,"yyyyMMdd"),g.postData.sDateEnd=i(g.queryBean.oDateEnd,"yyyyMMdd"),g.postData.sHandleDateStart=i(g.queryBean.oHandleDateStart,"yyyyMMdd"),g.postData.sHandleDateEnd=i(g.queryBean.oHandleDateEnd,"yyyyMMdd"),t.post(g.url,a(g.postData)).then(function(e){var t=e.data;t.success?(g.pagination=t.object,g.sumObject=t.sumObject,o.clearChecked()):alert(t.msg)})}function u(){g.queryBean={oDateStart:y.getYesterday(),oDateEnd:y.getToday()}}function s(e,r){confirm("确认操作？")&&t.post("handle",a({id:e,handleType:r})).then(function(e){var t=e.data;t.success?(g.queryDetail(),alert("操作成功")):alert("操作失败:"+t.msg)},function(e){alert(e.statusText),n.debug("error")})}function p(n){var r=o.getCheckedNew(g.pagination.list);if(0==r.length)return void alert("请选择记录！");for(var c=[],i=0;i<r.length;i++){var d=r[i];d.button&&d.button.indexOf(n)>=0&&c.push(d.id)}var y;if("02"==n)y="补业务";else{if("03"!=n)return void alert("操作方式参数错误!!");y="退银行"}confirm("确认批量"+y+"？已选中【"+r.length+"】笔差异,其中可"+y+"差异为【"+c.length+"】笔")&&t.post(config.ctx+"/check/bankChkErr/batchHandle",a({ids:c,handleType:n})).then(function(t){var a=t.data;a.success?(alert("批量"+y+"处理成功!!请在页面查看结果"),e.cancel()):alert("批量"+y+"处理失败!!")},function(){alert("批量处理失败!")})}var g=e.vm={};g.constant=d,g.downCfg={contentType:"jqLike",date:{oDateStart:"yyyyMMdd",oDateEnd:"yyyyMMdd",oHandleDateStart:"yyyyMMddHHmmss",oHandleDateEnd:"yyyyMMddHHmmss"}},g.pagination={pageSize:10,pageNum:1},g.queryBean={oDateStart:y.getYesterday(),oDateEnd:y.getToday()},g.validateOptions={blurTrig:!0,showError:function(e,t){},removeError:!0},g.queryDetail=l,g.resetForm=u,g.handle=s,g.batchHandle=p,g.cached={COMANY_CODE:{},MERCHANT_CODE:{}},c.initCache(g.cached),g.getCache=function(e){return c.getCache(e)},g.getObj=function(e,r){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return limitToFilter(filterFilter(e.data.object,r),6)},function(e){n.error("获取数据%s失败",cacheKey)})}}]);