angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","myConstant",function(e,t,a,n,i,o,r,c,u,l){function d(){var e=document.getElementById("queryForm");E.url=angular.element(e).prop("action"),E.postData=E.queryBean,E.postData.pageSize=E.pagination.pageSize,E.postData.pageNum=E.pagination.pageNum,t.post(E.url,a(E.postData)).then(function(e){var t=e.data;t.success?(E.pagination=t.object,o.clearChecked()):alert(t.msg)})}function s(){E.queryBean={}}function p(e,t){o.updateChecked(e,t),n.debug(t),n.debug(o.getChecked())}function g(){i({modalTitle:"新增对账配置",modalBody:"toAdd",url:"add",item:{},cached:{MERCHANT_CODE:r.getCache("MERCHANT_CODE"),FILE_TEMPLATE_NO:r.getCache("FILE_TEMPLATE_NO")}},function(e){E.queryDetail()},"","myModalNoFooter.html")}function h(){if(1!=o.getCheckedNew(E.pagination.list).length)return void alert("必须勾选一条记录！");var e=o.getCheckedNew(E.pagination.list)[0];e.createdTime=null,e.updatedTime=null,i({modalTitle:"修改对账配置",modalBody:"toUpdate",url:"update",item:e,cached:{MERCHANT_CODE:E.cached.MERCHANT_CODE}},function(e){E.queryDetail()},"","myModalNoFooter.html")}function m(){return 1!=o.getChecked().length?void alert("必须勾选一条记录！"):void t.post("delete",a({userId:o.getChecked()[0]})).then(function(e){var t=e.data;if(t.success){var a=E.pagination.list.filter(function(e,t,a){return e.userId==o.getChecked()[0]})[0];E.pagination.list.splice(E.pagination.list.indexOf(a),1),alert("操作成功")}else alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}function f(e){t.post("open",a({id:e})).then(function(e){var t=e.data;t.success?(E.queryDetail(),alert("操作成功")):alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}function C(e){t.post("close",a({id:e})).then(function(e){var t=e.data;t.success?(E.queryDetail(),alert("操作成功")):alert("操作失败")},function(e){alert(e.statusText),n.debug("error")})}var E=e.vm={};E.constant=l,E.pagination={pageSize:10,pageNum:1},E.queryBean={},E.queryDetail=d,E.resetForm=s,E.updateChecked=p,E.addItem=g,E.updateItem=h,E.deleteItem=m,E.openItem=f,E.closeItem=C,E.cached={MERCHANT_CODE:{},FILE_TEMPLATE_NO:{}},r.initCache(E.cached),E.getCache=function(e){return r.getCache(e)},E.getObj=function(e,i){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return c(u(e.data.object,i),6)},function(e){n.error("获取数据%s失败",cacheKey)})}}]);