angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant","DateCalculateService",function(e,t,a,n,o,r,i,c,l,d,u,s){function y(){document.getElementById("queryForm");m.url=config.ctx+"/orderMain/download",m.postData=angular.copy(m.queryBean),m.postData.beginOrderDate=d(m.postData.beginOrderDate,"yyyyMMdd"),m.postData.endOrderDate=d(m.postData.endOrderDate,"yyyyMMdd"),m.postData.beginSettleDate=d(m.postData.beginSettleDate,"yyyyMMdd"),m.postData.endSettleDate=d(m.postData.endSettleDate,"yyyyMMdd"),t.post(m.url,a(m.postData)).then(function(e){var t=e.data;if(t.success){if(!confirm("文件已经保存到下载中心，是否跳转到下载中心？"))return;window.location.href=config.ctx+"/download/userDownload/init"}else alert(t.msg)})}function p(){var e=document.getElementById("queryForm");m.url=angular.element(e).prop("action"),m.postData=angular.copy(m.queryBean),m.postData.pageSize=m.pagination.pageSize,m.postData.pageNum=m.pagination.pageNum,m.postData.beginOrderDate=d(m.postData.beginOrderDate,"yyyyMMdd"),m.postData.endOrderDate=d(m.postData.endOrderDate,"yyyyMMdd"),m.postData.beginSettleDate=d(m.postData.beginSettleDate,"yyyyMMdd"),m.postData.endSettleDate=d(m.postData.endSettleDate,"yyyyMMdd"),t.post(m.url,a(m.postData)).then(function(e){var t=e.data;t.success?(m.pagination=t.object,m.sumObject=t.sumObject):alert(t.msg)})}function D(){m.queryBean={}}function g(e){var n;t.post(config.ctx+"/orderMain/queryOrderMainDetail",a({ourTransNo:e})).then(function(t){var a=t.data;a.success?(n=a.object,o({modalTitle:"订单查询",modalBody:"toQueryDetail",url:"queryDetail",item:{results:n,ourTransNo:e},cached:m.cached},function(e){},"QueryDetailModalInstanceCtrl","myModalNoSave.html")):alert(a.msg)})}var m=e.vm={};m.constant=u,m.pagination={pageSize:10,pageNum:1},m.queryBean={beginSettleDate:s.getYesterday(),endSettleDate:s.getToday()},m.cached={ORDER_STATUS:{},NOTIFY_STATUS:{},CONN_CHANNEL:{},REVERSE_FLAG:{},MERCHANT_CODE:{},MERCHANT_ABBR_NAME:{},ORDER_TYPE:{}},i.initCache(m.cached),m.getCache=function(e){return i.getCache(e)},m.getObj=function(e,o){return t.post(config.ctx+"/base/cache/getAll",a({cacheKey:e})).then(function(e){return c(l(e.data.object,o),6)},function(e){n.error("获取数据%s失败",cacheKey)})},m.queryDetail=p,m.resetForm=D,m.download=y,m.queryOrderMainDetail=g}]),angular.module("myApp").controller("QueryDetailModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike",function(e,t,a,n,o){var r=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};r=e.vm=a,e.cancel=function(){t.dismiss("cancel")}}]);