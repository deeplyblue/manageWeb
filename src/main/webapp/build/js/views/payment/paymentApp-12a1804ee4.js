angular.module("myApp").controller("queryCtrl",["$scope","$http","$httpParamSerializerJQLike","$log","OpenService","CheckboxService","CacheService","limitToFilter","filterFilter","dateFilter","myConstant","DateCalculateService",function(e,a,t,o,n,l,i,r,c,u,d,s){function m(){document.getElementById("queryForm");v.url=config.ctx+"/payment/searchPaymentBatchList",v.postData=angular.copy(v.queryBean),v.postData.pageSize=v.pagination.pageSize,v.postData.pageNum=v.pagination.pageNum,v.postData.beginDate=u(v.postData.beginDate,"yyyyMMdd"),v.postData.endDate=u(v.postData.endDate,"yyyyMMdd"),v.postData.operateBeginDate=u(v.postData.operateBeginDate,"yyyyMMdd"),v.postData.operateEndDate=u(v.postData.operateEndDate,"yyyyMMdd"),a.post(v.url,t(v.postData)).then(function(e){var a=e.data;a.success?(v.pagination=a.object,l.clearChecked()):alert(a.msg)})}function p(){v.queryBean={}}function f(){n({modalTitle:"文件上传",modalBody:"toUpload",url:"upload",item:{},cached:{}},function(e){m()},"uploadModalInstanceCtrl","myModalNoSave.html")}function y(){n({modalTitle:"确认文件上传",modalBody:"toConfirmUpload",url:"confirmUpload",item:{},cached:{}},function(e){m()},"confirmUploadModalInstanceCtrl","myModalNoSave.html")}function g(e){var o;a.post(config.ctx+"/payment/queryPaymentDetail",t({batchNo:e})).then(function(a){var t=a.data;t.success?(o=t.object,n({modalTitle:"付款明细查询",modalBody:"toQueryDetail",url:"queryDetail",item:{results:o,batchNo:e},cached:{ORDER_STATUS:v.cached.ORDER_STATUS}},function(e){m()},"QueryDetailModalInstanceCtrl","myModalNoSave.html")):alert(t.msg)})}function h(e){return!!confirm("确认取消文件？")&&void a.post(config.ctx+"/payment/check",t({auditState:"03",batchNo:e,verifyCode:"",smsVerifyCode:""})).then(function(e){var a=e.data;a.success?(alert("处理成功"),m()):alert(a.msg)})}var v=e.vm={};v.constant=d,v.pagination={pageSize:10,pageNum:1},v.queryBean={beginDate:s.getYesterday(),endDate:s.getToday()},v.cached={ORDER_STATUS:{}},i.initCache(v.cached),v.getCache=function(e){return i.getCache(e)},v.getObj=function(e,n){return a.post(config.ctx+"/base/cache/getAll",t({cacheKey:e})).then(function(e){return r(c(e.data.object,n),6)},function(e){o.error("获取数据%s失败",cacheKey)})},v.queryDetail=m,v.resetForm=p,v.upload=f,v.confirmUpload=y,v.queryPaymentDetail=g,v.cancel=h}]),angular.module("myApp").controller("QueryDetailModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","CheckboxService","$httpParamSerializerJQLike",function(e,a,t,o,n,l){function i(){m.queryBean={}}function r(){var e=m.item.batchNo;return null==e||void 0==e||""==e?(alert("批次号不能为空"),!1):!!confirm("确认付款已中断？")&&void o.post(config.ctx+"/payment/paymentAgain",l({batchNo:e})).then(function(e){var a=e.data;a.success?alert("处理成功"):alert(a.msg)})}function c(e){var a=m.item.batchNo,t=m.queryBean.verifyCode,n=m.queryBean.smsVerifyCode;if("04"==e){if(void 0==t||""==t)return alert("密码不能为空"),!1;if(void 0==n||""==n)return alert("短信验证码不能为空"),!1;m.popover.open=!1}return!!confirm("04"==e?"确认发起付款？":"确认取消文件？")&&void o.post(config.ctx+"/payment/check",l({auditState:e,batchNo:a,verifyCode:t,smsVerifyCode:n})).then(function(a){var t=a.data;t.success?(alert("处理成功"),m.pagination.list[0].auditState=e):alert(t.msg),m.queryBean.verifyCode="",m.queryBean.smsVerifyCode=""})}function u(){var e=m.queryBean.verifyCode;return void 0==e||""==e?(alert("密码不能为空"),!1):void $.getJSON(config.ctx+"/payment/smsVerifyCode",function(e){if(e.success){alert("短信发送成功!");var a=60;$("#smsWrap").hide(),$("#smsSecond").show();var t=window.setInterval(function(){$("#smsSecond").text(a+"秒后重发"),a--,0==a&&($("#smsWrap").show(),$("#smsSecond").hide(),window.clearInterval(t))},1e3)}else alert("短信发送失败!")})}function d(){document.getElementById("queryForm");m.url=config.ctx+"/payment/queryPaymentDetail",m.postData=angular.copy(m.queryBean),m.postData.pageSize=m.pagination.pageSize,m.postData.pageNum=m.pagination.pageNum,m.postData.batchNo=m.item.batchNo,o.post(m.url,l(m.postData)).then(function(e){var a=e.data;a.success?(m.pagination=a.object,n.clearChecked()):alert(a.msg)})}function s(){var e=m.item.batchNo;return null==e||void 0==e||""==e?(alert("批次号为空"),!1):void o.post(config.ctx+"/payment/checkDownloadResultFile",l({batchNo:m.item.batchNo})).then(function(e){var a=e.data;a.success?location.href=config.ctx+"/payment/downloadResultFile?batchNo="+m.item.batchNo:alert(a.msg)})}var m=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};m=e.vm=t,m.queryBean={},m.pagination={pageSize:10,pageNum:1,rowCount:m.item.results.rowCount,list:m.item.results.list},m.myPopoverTemplate="myPopoverTemplate.html",m.popover={open:!1},m.queryDetail=d,m.check=c,m.sendSmsVerifyCode=u,m.resetForm=i,m.downloadResultFile=s,m.paymentAgain=r,e.save=function(){},e.cancel=function(){a.dismiss("cancel")}}]),angular.module("myApp").controller("uploadModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","FileUploader","$log",function(e,a,t,o,n,l,i){function r(){location.href=config.ctx+"/payment/downloadTemplate"}function c(){if(1!=u.fileUploader.queue.length)return alert("只能选择一个文件"),!1;if(1!=u.fileUploader.queue[0].isSuccess)return alert("请先上传文件"),!1;var a={};a.originFileName=u.fileUploader.queue[0].originFileName,a.dfsFullFilename=u.fileUploader.queue[0].dfsFullFilename,a.dfsGroupName=u.fileUploader.queue[0].dfsGroupName,o.post(config.ctx+"/payment/uploadFile",n(a)).then(function(a){var t=a.data;t.success?(alert("提交成功"),e.cancel()):alert(t.msg)})}var u=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};u=e.vm=t,u.fileUploader=new l({url:config.ctx+"/system/fileUploader/upload",formData:[{busiType:"DF",remark:"代付管理"}],filters:[{name:"limitItem",fn:function(e){return!(u.fileUploader.queue.length>=1)||(alert("请先取消原先文件,再选择新文件!"),!1)}}]}),u.fileUploader.onSuccessItem=function(e,a,t,o){e.originFileName=e.file.name,e.dfsFullFilename=a.object.dfsFullFilename,e.dfsGroupName=a.object.dfsGroupName},u.fileUploader.onCancelItem=function(e,a,t,o){},u.uploadBean={},u.downLoadTemplate=r,u.uploadFile=c,e.save=function(){},e.cancel=function(){a.dismiss("cancel")}}]),angular.module("myApp").controller("confirmUploadModalInstanceCtrl",["$scope","$uibModalInstance","modalItem","$http","$httpParamSerializerJQLike","FileUploader","$log",function(e,a,t,o,n,l,i){function r(){if(1!=c.fileUploader.queue.length)return alert("只能选择一个文件"),!1;if(1!=c.fileUploader.queue[0].isSuccess)return alert("请先上传文件"),!1;var a={};a.originFileName=c.fileUploader.queue[0].originFileName,a.dfsFullFilename=c.fileUploader.queue[0].dfsFullFilename,a.dfsGroupName=c.fileUploader.queue[0].dfsGroupName,o.post(config.ctx+"/payment/confirmUploadFile",n(a)).then(function(a){var t=a.data;t.success?(alert("提交成功"),e.cancel()):alert(t.msg)})}var c=e.vm={modalTitle:"please change the title",modalBody:"#",url:"",item:{}};c=e.vm=t,c.fileUploader=new l({url:config.ctx+"/system/fileUploader/upload",formData:[{busiType:"DF",remark:"代付管理"}],filters:[{name:"limitItem",fn:function(e){return!(c.fileUploader.queue.length>=1)||(alert("请先取消原先文件,再选择新文件!"),!1)}}]}),c.fileUploader.onSuccessItem=function(e,a,t,o){e.originFileName=e.file.name,e.dfsFullFilename=a.object.dfsFullFilename,e.dfsGroupName=a.object.dfsGroupName},c.fileUploader.onCancelItem=function(e,a,t,o){},c.uploadBean={},c.confirmUploadFile=r,e.save=function(){},e.cancel=function(){a.dismiss("cancel")}}]);