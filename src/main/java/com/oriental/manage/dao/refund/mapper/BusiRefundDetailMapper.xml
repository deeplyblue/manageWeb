<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.oriental.manage.dao.refund.BusiRefundDetailMapper">
    <resultMap id="BaseResultMap" type="com.oriental.manage.pojo.refund.BusiRefundDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="ID" property="id" jdbcType="VARCHAR"/>
        <result column="MCHNT_CODE" property="mchntCode" jdbcType="VARCHAR"/>
        <result column="ORDER_NO" property="orderNo" jdbcType="VARCHAR"/>
        <result column="ORDER_DATE" property="orderDate" jdbcType="TIMESTAMP"/>
        <result column="TOTAL_AMT" property="totalAmt" jdbcType="DECIMAL"/>
        <result column="REFUND_AMT" property="refundAmt" jdbcType="DECIMAL"/>
        <result column="TOTAL_REFUND_AMOUNT" property="totalRefundAmount" jdbcType="DECIMAL"/>
        <result column="OLD_OUR_TRANS_NO" property="oldOurTransNo" jdbcType="VARCHAR"/>
        <result column="OLD_ORDER_NO" property="oldOrderNo" jdbcType="VARCHAR"/>
        <result column="SPLIT_INFO" property="splitInfo" jdbcType="VARCHAR"/>
        <result column="ORDER_ADJ_STATUS" property="orderAdjStatus" jdbcType="VARCHAR"/>
        <result column="TRANS_INFO_TYPE" property="transInfoType" jdbcType="VARCHAR"/>
        <result column="REFUND_STATUS" property="refundStatus" jdbcType="VARCHAR"/>
        <result column="REFUND_APPLICANT" property="refundApplicant" jdbcType="VARCHAR"/>
        <result column="APPLICANT_IP" property="applicantIp" jdbcType="VARCHAR"/>
        <result column="REFUND_DATE" property="refundDate" jdbcType="TIMESTAMP"/>
        <result column="AUDITOR" property="auditor" jdbcType="VARCHAR"/>
        <result column="AUDIT_DATE" property="auditDate" jdbcType="TIMESTAMP"/>
        <result column="PROC_EMP_ID" property="procEmpId" jdbcType="VARCHAR"/>
        <result column="PROC_DATETIME" property="procDatetime" jdbcType="TIMESTAMP"/>
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP"/>
        <result column="LAST_UPD_TIME" property="lastUpdTime" jdbcType="TIMESTAMP"/>
        <result column="SPARE1" property="spare1" jdbcType="VARCHAR"/>
        <result column="SPARE2" property="spare2" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        ID, MCHNT_CODE, ORDER_NO, ORDER_DATE, TOTAL_AMT, REFUND_AMT, TOTAL_REFUND_AMOUNT,
        OLD_OUR_TRANS_NO, OLD_ORDER_NO, SPLIT_INFO, ORDER_ADJ_STATUS, TRANS_INFO_TYPE, REFUND_STATUS,
        REFUND_APPLICANT, APPLICANT_IP, REFUND_DATE, AUDITOR, AUDIT_DATE, PROC_EMP_ID, PROC_DATETIME,
        CREATE_TIME, LAST_UPD_TIME, SPARE1, SPARE2
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from t_busi_refund_detail
        where ID = #{id,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from t_busi_refund_detail
        where ID = #{id,jdbcType=VARCHAR}
    </delete>
    <insert id="insert" parameterType="com.oriental.manage.pojo.refund.BusiRefundDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into t_busi_refund_detail (ID, MCHNT_CODE, ORDER_NO,
        ORDER_DATE, TOTAL_AMT, REFUND_AMT,
        TOTAL_REFUND_AMOUNT, OLD_OUR_TRANS_NO, OLD_ORDER_NO,
        SPLIT_INFO, ORDER_ADJ_STATUS, TRANS_INFO_TYPE,
        REFUND_STATUS, REFUND_APPLICANT, APPLICANT_IP,
        REFUND_DATE, AUDITOR, AUDIT_DATE,
        PROC_EMP_ID, PROC_DATETIME, CREATE_TIME,
        LAST_UPD_TIME, SPARE1, SPARE2
        )
        values (#{id,jdbcType=VARCHAR}, #{mchntCode,jdbcType=VARCHAR}, #{orderNo,jdbcType=VARCHAR},
        #{orderDate,jdbcType=TIMESTAMP}, #{totalAmt,jdbcType=DECIMAL}, #{refundAmt,jdbcType=DECIMAL},
        #{totalRefundAmount,jdbcType=DECIMAL}, #{oldOurTransNo,jdbcType=VARCHAR}, #{oldOrderNo,jdbcType=VARCHAR},
        #{splitInfo,jdbcType=VARCHAR}, #{orderAdjStatus,jdbcType=VARCHAR}, #{transInfoType,jdbcType=VARCHAR},
        #{refundStatus,jdbcType=VARCHAR}, #{refundApplicant,jdbcType=VARCHAR}, #{applicantIp,jdbcType=VARCHAR},
        #{refundDate,jdbcType=TIMESTAMP}, #{auditor,jdbcType=VARCHAR}, #{auditDate,jdbcType=TIMESTAMP},
        #{procEmpId,jdbcType=VARCHAR}, #{procDatetime,jdbcType=TIMESTAMP}, #{createTime,jdbcType=TIMESTAMP},
        #{lastUpdTime,jdbcType=TIMESTAMP}, #{spare1,jdbcType=VARCHAR}, #{spare2,jdbcType=VARCHAR}
        )
    </insert>
    <insert id="insertSelective" parameterType="com.oriental.manage.pojo.refund.BusiRefundDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into t_busi_refund_detail
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                ID,
            </if>
            <if test="mchntCode != null">
                MCHNT_CODE,
            </if>
            <if test="orderNo != null">
                ORDER_NO,
            </if>
            <if test="orderDate != null">
                ORDER_DATE,
            </if>
            <if test="totalAmt != null">
                TOTAL_AMT,
            </if>
            <if test="refundAmt != null">
                REFUND_AMT,
            </if>
            <if test="totalRefundAmount != null">
                TOTAL_REFUND_AMOUNT,
            </if>
            <if test="oldOurTransNo != null">
                OLD_OUR_TRANS_NO,
            </if>
            <if test="oldOrderNo != null">
                OLD_ORDER_NO,
            </if>
            <if test="splitInfo != null">
                SPLIT_INFO,
            </if>
            <if test="orderAdjStatus != null">
                ORDER_ADJ_STATUS,
            </if>
            <if test="transInfoType != null">
                TRANS_INFO_TYPE,
            </if>
            <if test="refundStatus != null">
                REFUND_STATUS,
            </if>
            <if test="refundApplicant != null">
                REFUND_APPLICANT,
            </if>
            <if test="applicantIp != null">
                APPLICANT_IP,
            </if>
            <if test="refundDate != null">
                REFUND_DATE,
            </if>
            <if test="auditor != null">
                AUDITOR,
            </if>
            <if test="auditDate != null">
                AUDIT_DATE,
            </if>
            <if test="procEmpId != null">
                PROC_EMP_ID,
            </if>
            <if test="procDatetime != null">
                PROC_DATETIME,
            </if>
            <if test="createTime != null">
                CREATE_TIME,
            </if>
            <if test="lastUpdTime != null">
                LAST_UPD_TIME,
            </if>
            <if test="spare1 != null">
                SPARE1,
            </if>
            <if test="spare2 != null">
                SPARE2,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=VARCHAR},
            </if>
            <if test="mchntCode != null">
                #{mchntCode,jdbcType=VARCHAR},
            </if>
            <if test="orderNo != null">
                #{orderNo,jdbcType=VARCHAR},
            </if>
            <if test="orderDate != null">
                #{orderDate,jdbcType=TIMESTAMP},
            </if>
            <if test="totalAmt != null">
                #{totalAmt,jdbcType=DECIMAL},
            </if>
            <if test="refundAmt != null">
                #{refundAmt,jdbcType=DECIMAL},
            </if>
            <if test="totalRefundAmount != null">
                #{totalRefundAmount,jdbcType=DECIMAL},
            </if>
            <if test="oldOurTransNo != null">
                #{oldOurTransNo,jdbcType=VARCHAR},
            </if>
            <if test="oldOrderNo != null">
                #{oldOrderNo,jdbcType=VARCHAR},
            </if>
            <if test="splitInfo != null">
                #{splitInfo,jdbcType=VARCHAR},
            </if>
            <if test="orderAdjStatus != null">
                #{orderAdjStatus,jdbcType=VARCHAR},
            </if>
            <if test="transInfoType != null">
                #{transInfoType,jdbcType=VARCHAR},
            </if>
            <if test="refundStatus != null">
                #{refundStatus,jdbcType=VARCHAR},
            </if>
            <if test="refundApplicant != null">
                #{refundApplicant,jdbcType=VARCHAR},
            </if>
            <if test="applicantIp != null">
                #{applicantIp,jdbcType=VARCHAR},
            </if>
            <if test="refundDate != null">
                #{refundDate,jdbcType=TIMESTAMP},
            </if>
            <if test="auditor != null">
                #{auditor,jdbcType=VARCHAR},
            </if>
            <if test="auditDate != null">
                #{auditDate,jdbcType=TIMESTAMP},
            </if>
            <if test="procEmpId != null">
                #{procEmpId,jdbcType=VARCHAR},
            </if>
            <if test="procDatetime != null">
                #{procDatetime,jdbcType=TIMESTAMP},
            </if>
            <if test="createTime != null">
                #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="lastUpdTime != null">
                #{lastUpdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="spare1 != null">
                #{spare1,jdbcType=VARCHAR},
            </if>
            <if test="spare2 != null">
                #{spare2,jdbcType=VARCHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.oriental.manage.pojo.refund.BusiRefundDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_busi_refund_detail
        <set>
            <if test="mchntCode != null">
                MCHNT_CODE = #{mchntCode,jdbcType=VARCHAR},
            </if>
            <if test="orderNo != null">
                ORDER_NO = #{orderNo,jdbcType=VARCHAR},
            </if>
            <if test="orderDate != null">
                ORDER_DATE = #{orderDate,jdbcType=TIMESTAMP},
            </if>
            <if test="totalAmt != null">
                TOTAL_AMT = #{totalAmt,jdbcType=DECIMAL},
            </if>
            <if test="refundAmt != null">
                REFUND_AMT = #{refundAmt,jdbcType=DECIMAL},
            </if>
            <if test="totalRefundAmount != null">
                TOTAL_REFUND_AMOUNT = #{totalRefundAmount,jdbcType=DECIMAL},
            </if>
            <if test="oldOurTransNo != null">
                OLD_OUR_TRANS_NO = #{oldOurTransNo,jdbcType=VARCHAR},
            </if>
            <if test="oldOrderNo != null">
                OLD_ORDER_NO = #{oldOrderNo,jdbcType=VARCHAR},
            </if>
            <if test="splitInfo != null">
                SPLIT_INFO = #{splitInfo,jdbcType=VARCHAR},
            </if>
            <if test="orderAdjStatus != null">
                ORDER_ADJ_STATUS = #{orderAdjStatus,jdbcType=VARCHAR},
            </if>
            <if test="transInfoType != null">
                TRANS_INFO_TYPE = #{transInfoType,jdbcType=VARCHAR},
            </if>
            <if test="refundStatus != null">
                REFUND_STATUS = #{refundStatus,jdbcType=VARCHAR},
            </if>
            <if test="refundApplicant != null">
                REFUND_APPLICANT = #{refundApplicant,jdbcType=VARCHAR},
            </if>
            <if test="applicantIp != null">
                APPLICANT_IP = #{applicantIp,jdbcType=VARCHAR},
            </if>
            <if test="refundDate != null">
                REFUND_DATE = #{refundDate,jdbcType=TIMESTAMP},
            </if>
            <if test="auditor != null">
                AUDITOR = #{auditor,jdbcType=VARCHAR},
            </if>
            <if test="auditDate != null">
                AUDIT_DATE = #{auditDate,jdbcType=TIMESTAMP},
            </if>
            <if test="procEmpId != null">
                PROC_EMP_ID = #{procEmpId,jdbcType=VARCHAR},
            </if>
            <if test="procDatetime != null">
                PROC_DATETIME = #{procDatetime,jdbcType=TIMESTAMP},
            </if>
            <if test="createTime != null">
                CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
            </if>
            <if test="lastUpdTime != null">
                LAST_UPD_TIME = #{lastUpdTime,jdbcType=TIMESTAMP},
            </if>
            <if test="spare1 != null">
                SPARE1 = #{spare1,jdbcType=VARCHAR},
            </if>
            <if test="spare2 != null">
                SPARE2 = #{spare2,jdbcType=VARCHAR},
            </if>
        </set>
        where ID = #{id,jdbcType=VARCHAR}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.oriental.manage.pojo.refund.BusiRefundDetail">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_busi_refund_detail
        set MCHNT_CODE = #{mchntCode,jdbcType=VARCHAR},
        ORDER_NO = #{orderNo,jdbcType=VARCHAR},
        ORDER_DATE = #{orderDate,jdbcType=TIMESTAMP},
        TOTAL_AMT = #{totalAmt,jdbcType=DECIMAL},
        REFUND_AMT = #{refundAmt,jdbcType=DECIMAL},
        TOTAL_REFUND_AMOUNT = #{totalRefundAmount,jdbcType=DECIMAL},
        OLD_OUR_TRANS_NO = #{oldOurTransNo,jdbcType=VARCHAR},
        OLD_ORDER_NO = #{oldOrderNo,jdbcType=VARCHAR},
        SPLIT_INFO = #{splitInfo,jdbcType=VARCHAR},
        ORDER_ADJ_STATUS = #{orderAdjStatus,jdbcType=VARCHAR},
        TRANS_INFO_TYPE = #{transInfoType,jdbcType=VARCHAR},
        REFUND_STATUS = #{refundStatus,jdbcType=VARCHAR},
        REFUND_APPLICANT = #{refundApplicant,jdbcType=VARCHAR},
        APPLICANT_IP = #{applicantIp,jdbcType=VARCHAR},
        REFUND_DATE = #{refundDate,jdbcType=TIMESTAMP},
        AUDITOR = #{auditor,jdbcType=VARCHAR},
        AUDIT_DATE = #{auditDate,jdbcType=TIMESTAMP},
        PROC_EMP_ID = #{procEmpId,jdbcType=VARCHAR},
        PROC_DATETIME = #{procDatetime,jdbcType=TIMESTAMP},
        CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
        LAST_UPD_TIME = #{lastUpdTime,jdbcType=TIMESTAMP},
        SPARE1 = #{spare1,jdbcType=VARCHAR},
        SPARE2 = #{spare2,jdbcType=VARCHAR}
        where ID = #{id,jdbcType=VARCHAR}
    </update>

    <select id="selectForRefundApply"
            resultMap="com.oriental.manage.dao.transaction.BusiTransDetailMapper.BaseResultMap"
            parameterType="com.oriental.manage.pojo.refund.BusiRefundDetail">
        <include refid="BaseMapper.pageHead"/>
        SELECT busi.*
        FROM t_busi_trans_detail busi
        LEFT JOIN t_busi_refund_detail refund
        ON busi.ORDER_NO = refund.OLD_ORDER_NO
        WHERE
        1 = 1
        AND (refund.REFUND_STATUS is NULL or refund.REFUND_STATUS in ('3','4','5'))
        AND busi.DELETE_FLAG = '0'
        AND busi.TRANS_STATUS = 'B'
        AND busi.MCHNT_CODE = #{mchntCode}
        AND busi.TRANS_CODE = #{transCode}
        AND busi.SETTLE_DATE &gt;= #{beginOrderDate,jdbcType=TIMESTAMP}
        AND busi.SETTLE_DATE &lt;= #{endOrderDate,jdbcType=TIMESTAMP}
        <if test="orderNo != null and orderNo != ''">
            AND busi.ORDER_NO = #{orderNo}
        </if>
        <if test="ourTransNo != null and ourTransNo != ''">
            AND busi.OUR_TRANS_NO = #{ourTransNo}
        </if>

        <include refid="BaseMapper.pageFoot"/>
    </select>

    <select id="sumFindCommonRefundOrder" resultType="Map" parameterType="com.oriental.manage.pojo.refund.BusiRefundDetail">

        SELECT COUNT(1) AS sumCount, SUM(busi.TRANS_AMT) AS sumTotalAmt
        FROM t_busi_trans_detail busi
        LEFT JOIN t_busi_refund_detail refund
        ON busi.ORDER_NO = refund.OLD_ORDER_NO
        WHERE
        1 = 1
        AND (refund.REFUND_STATUS is NULL or refund.REFUND_STATUS in ('3','4','5'))
        AND busi.DELETE_FLAG = '0'
        AND busi.TRANS_STATUS = 'B'
        AND busi.MCHNT_CODE = #{mchntCode}
        AND busi.TRANS_CODE = #{transCode}
        AND busi.SETTLE_DATE &gt;= #{beginOrderDate,jdbcType=TIMESTAMP}
        AND busi.SETTLE_DATE &lt;= #{endOrderDate,jdbcType=TIMESTAMP}
        <if test="orderNo != null and orderNo != ''">
            AND busi.ORDER_NO = #{orderNo}
        </if>
        <if test="ourTransNo != null and ourTransNo != ''">
            AND busi.OUR_TRANS_NO = #{ourTransNo}
        </if>

    </select>

    <select id="selectBySelective" resultMap="BaseResultMap"
            parameterType="com.oriental.manage.pojo.refund.BusiRefundDetail">
        <include refid="BaseMapper.pageHead"/>
        SELECT <include refid="Base_Column_List"/>
        FROM t_busi_refund_detail
        WHERE 1 = 1
        AND REFUND_DATE &gt;= #{beginDate,jdbcType=TIMESTAMP}
        AND REFUND_DATE &lt;= date_add(#{endDate,jdbcType=TIMESTAMP},interval 1 day)
        <include refid="condition"/>
        <include refid="BaseMapper.pageFoot"/>
    </select>

    <select id="sumBusiRefund" resultType="Map" parameterType="com.oriental.manage.pojo.refund.BusiRefundDetail">

        SELECT COUNT(1) AS sumCount, SUM(REFUND_AMT) AS sumTotalAmt
        FROM t_busi_refund_detail
        WHERE 1 = 1
        AND REFUND_DATE &gt;= #{beginDate,jdbcType=TIMESTAMP}
        AND REFUND_DATE &lt;= date_add(#{endDate,jdbcType=TIMESTAMP},interval 1 day)
        <include refid="condition"/>

    </select>

    <sql id="condition">
        <if test="mchntCode != null and  mchntCode != ''">
            AND MCHNT_CODE = #{mchntCode,jdbcType=VARCHAR}
        </if>
        <if test="orderNo != null and  orderNo != ''">
            AND ORDER_NO = #{orderNo,jdbcType=VARCHAR}
        </if>
        <if test="orderDate != null and  orderDate != ''">
            AND ORDER_DATE = #{orderDate,jdbcType=TIMESTAMP}
        </if>
        <if test="totalAmt != null and  totalAmt != ''">
            AND TOTAL_AMT = #{totalAmt,jdbcType=DECIMAL}
        </if>
        <if test="refundAmt != null and  refundAmt != ''">
            AND REFUND_AMT = #{refundAmt,jdbcType=DECIMAL}
        </if>
        <if test="totalRefundAmount != null and  totalRefundAmount != ''">
            AND TOTAL_REFUND_AMOUNT = #{totalRefundAmount,jdbcType=DECIMAL}
        </if>
        <if test="oldOurTransNo != null and  oldOurTransNo != ''">
            AND OLD_OUR_TRANS_NO = #{oldOurTransNo,jdbcType=VARCHAR}
        </if>
        <if test="oldOrderNo != null and  oldOrderNo != ''">
            AND OLD_ORDER_NO = #{oldOrderNo,jdbcType=VARCHAR}
        </if>
        <if test="splitInfo != null and  splitInfo != ''">
            AND SPLIT_INFO = #{splitInfo,jdbcType=VARCHAR}
        </if>
        <if test="orderAdjStatus != null and  orderAdjStatus != ''">
            AND ORDER_ADJ_STATUS = #{orderAdjStatus,jdbcType=VARCHAR}
        </if>
        <if test="transInfoType != null and  transInfoType != ''">
            AND TRANS_INFO_TYPE = #{transInfoType,jdbcType=VARCHAR}
        </if>
        <if test="refundStatus != null and  refundStatus != ''">
            AND REFUND_STATUS = #{refundStatus,jdbcType=VARCHAR}
        </if>
        <if test="refundApplicant != null and  refundApplicant != ''">
            AND REFUND_APPLICANT = #{refundApplicant,jdbcType=VARCHAR}
        </if>
        <if test="applicantIp != null and  applicantIp != ''">
            AND APPLICANT_IP = #{applicantIp,jdbcType=VARCHAR}
        </if>
        <if test="refundDate != null and  refundDate != ''">
            AND REFUND_DATE = #{refundDate,jdbcType=TIMESTAMP}
        </if>
        <if test="auditor != null and  auditor != ''">
            AUDITOR = #{auditor,jdbcType=VARCHAR}
        </if>
        <if test="auditDate != null and  auditDate != ''">
            AND AUDIT_DATE = #{auditDate,jdbcType=TIMESTAMP}
        </if>
        <if test="procEmpId != null and  procEmpId != ''">
            AND PROC_EMP_ID = #{procEmpId,jdbcType=VARCHAR}
        </if>
        <if test="procDatetime != null and  procDatetime != ''">
            AND PROC_DATETIME = #{procDatetime,jdbcType=TIMESTAMP}
        </if>
        <if test="createTime != null and  createTime != ''">
            AND CREATE_TIME = #{createTime,jdbcType=TIMESTAMP}
        </if>
        <if test="lastUpdTime != null and  lastUpdTime != ''">
            AND LAST_UPD_TIME = #{lastUpdTime,jdbcType=TIMESTAMP}
        </if>
        <if test="spare1 != null and  spare1 != ''">
            AND SPARE1 = #{spare1,jdbcType=VARCHAR}
        </if>
        <if test="spare2 != null and  spare2 != ''">
            AND SPARE2 = #{spare2,jdbcType=VARCHAR}
        </if>
    </sql>
</mapper>